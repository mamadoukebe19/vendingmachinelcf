"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable import/order */
const os = require("os");
const fs_path = require("path");
const fs = require("fs-extra");
const user_configuration_1 = require("../../lib/cli/user-configuration");
const parse_command_line_arguments_1 = require("../../lib/cli/parse-command-line-arguments");
// mock fs deeply
jest.mock('fs-extra');
const mockedFs = jest.mocked(fs, { shallow: true });
const USER_CONFIG = fs_path.join(os.homedir(), '.cdk.json');
test('load settings from both files if available', async () => {
    // GIVEN
    const GIVEN_CONFIG = new Map([
        [user_configuration_1.PROJECT_CONFIG, {
                project: 'foobar',
            }],
        [USER_CONFIG, {
                project: 'foo',
                test: 'bar',
            }],
    ]);
    // WHEN
    mockedFs.pathExists.mockImplementation(path => {
        return GIVEN_CONFIG.has(path);
    });
    mockedFs.readJSON.mockImplementation(path => {
        return GIVEN_CONFIG.get(path);
    });
    const config = await new user_configuration_1.Configuration().load();
    // THEN
    expect(config.settings.get(['project'])).toBe('foobar');
    expect(config.settings.get(['test'])).toBe('bar');
});
test('load context from all 3 files if available', async () => {
    // GIVEN
    const GIVEN_CONFIG = new Map([
        [user_configuration_1.PROJECT_CONFIG, {
                context: {
                    project: 'foobar',
                },
            }],
        [user_configuration_1.PROJECT_CONTEXT, {
                foo: 'bar',
            }],
        [USER_CONFIG, {
                context: {
                    test: 'bar',
                },
            }],
    ]);
    // WHEN
    mockedFs.pathExists.mockImplementation(path => {
        return GIVEN_CONFIG.has(path);
    });
    mockedFs.readJSON.mockImplementation(path => {
        return GIVEN_CONFIG.get(path);
    });
    const config = await new user_configuration_1.Configuration().load();
    // THEN
    expect(config.context.get('project')).toBe('foobar');
    expect(config.context.get('foo')).toBe('bar');
    expect(config.context.get('test')).toBe('bar');
});
test('throws an error if the `build` key is specified in the user config', async () => {
    // GIVEN
    const GIVEN_CONFIG = new Map([
        [USER_CONFIG, {
                build: 'foobar',
            }],
    ]);
    // WHEN
    mockedFs.pathExists.mockImplementation(path => {
        return GIVEN_CONFIG.has(path);
    });
    mockedFs.readJSON.mockImplementation(path => {
        return GIVEN_CONFIG.get(path);
    });
    // THEN
    await expect(new user_configuration_1.Configuration().load()).rejects.toEqual(new Error('The `build` key cannot be specified in the user config (~/.cdk.json), specify it in the project config (cdk.json) instead'));
});
test('Can specify the `quiet` key in the user config', async () => {
    // GIVEN
    const GIVEN_CONFIG = new Map([
        [USER_CONFIG, {
                quiet: true,
            }],
    ]);
    // WHEN
    mockedFs.pathExists.mockImplementation(path => {
        return GIVEN_CONFIG.has(path);
    });
    mockedFs.readJSON.mockImplementation(path => {
        return GIVEN_CONFIG.get(path);
    });
    // THEN
    const config = await new user_configuration_1.Configuration().load();
    expect(config.settings.get(['quiet'])).toBe(true);
});
test('array settings are not overridden by yarg defaults', async () => {
    // GIVEN
    const GIVEN_CONFIG = new Map([
        [user_configuration_1.PROJECT_CONFIG, {
                plugin: ['dummy'],
            }],
    ]);
    const argsWithPlugin = await (0, parse_command_line_arguments_1.parseCommandLineArguments)(['ls', '--plugin', '[]']);
    const argsWithoutPlugin = await (0, parse_command_line_arguments_1.parseCommandLineArguments)(['ls']);
    // WHEN
    mockedFs.pathExists.mockImplementation(path => {
        return GIVEN_CONFIG.has(path);
    });
    mockedFs.readJSON.mockImplementation(path => {
        return GIVEN_CONFIG.get(path);
    });
    const configWithPlugin = await new user_configuration_1.Configuration({
        commandLineArguments: argsWithPlugin,
    }).load();
    const configWithoutPlugin = await new user_configuration_1.Configuration({
        commandLineArguments: argsWithoutPlugin,
    }).load();
    // THEN
    expect(configWithPlugin.settings.get(['plugin'])).toEqual(['[]']);
    expect(configWithoutPlugin.settings.get(['plugin'])).toEqual(['dummy']);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1jb25maWcudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVzZXItY29uZmlnLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpQ0FBaUM7QUFDakMseUJBQXlCO0FBQ3pCLGdDQUFnQztBQUNoQywrQkFBK0I7QUFDL0IseUVBQWtHO0FBQ2xHLDZGQUF1RjtBQUV2RixpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUN0QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBRXBELE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBRTVELElBQUksQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtJQUM1RCxRQUFRO0lBQ1IsTUFBTSxZQUFZLEdBQXFCLElBQUksR0FBRyxDQUFDO1FBQzdDLENBQUMsbUNBQWMsRUFBRTtnQkFDZixPQUFPLEVBQUUsUUFBUTthQUNsQixDQUFDO1FBQ0YsQ0FBQyxXQUFXLEVBQUU7Z0JBQ1osT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsSUFBSSxFQUFFLEtBQUs7YUFDWixDQUFDO0tBQ0gsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLFFBQVEsQ0FBQyxVQUFVLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDNUMsT0FBTyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUMxQyxPQUFPLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksa0NBQWEsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO0lBRWhELE9BQU87SUFDUCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsNENBQTRDLEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDNUQsUUFBUTtJQUNSLE1BQU0sWUFBWSxHQUFxQixJQUFJLEdBQUcsQ0FBQztRQUM3QyxDQUFDLG1DQUFjLEVBQUU7Z0JBQ2YsT0FBTyxFQUFFO29CQUNQLE9BQU8sRUFBRSxRQUFRO2lCQUNsQjthQUNGLENBQUM7UUFDRixDQUFDLG9DQUFlLEVBQUU7Z0JBQ2hCLEdBQUcsRUFBRSxLQUFLO2FBQ1gsQ0FBQztRQUNGLENBQUMsV0FBVyxFQUFFO2dCQUNaLE9BQU8sRUFBRTtvQkFDUCxJQUFJLEVBQUUsS0FBSztpQkFDWjthQUNGLENBQUM7S0FDSCxDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsUUFBUSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUM1QyxPQUFPLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzFDLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxrQ0FBYSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7SUFFaEQsT0FBTztJQUNQLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNyRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2pELENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLG9FQUFvRSxFQUFFLEtBQUssSUFBSSxFQUFFO0lBQ3BGLFFBQVE7SUFDUixNQUFNLFlBQVksR0FBcUIsSUFBSSxHQUFHLENBQUM7UUFDN0MsQ0FBQyxXQUFXLEVBQUU7Z0JBQ1osS0FBSyxFQUFFLFFBQVE7YUFDaEIsQ0FBQztLQUNILENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxRQUFRLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzVDLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNILFFBQVEsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDMUMsT0FBTyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLE1BQU0sTUFBTSxDQUFDLElBQUksa0NBQWEsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssQ0FBQywySEFBMkgsQ0FBQyxDQUFDLENBQUM7QUFDbk0sQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsZ0RBQWdELEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDaEUsUUFBUTtJQUNSLE1BQU0sWUFBWSxHQUFxQixJQUFJLEdBQUcsQ0FBQztRQUM3QyxDQUFDLFdBQVcsRUFBRTtnQkFDWixLQUFLLEVBQUUsSUFBSTthQUNaLENBQUM7S0FDSCxDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsUUFBUSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUM1QyxPQUFPLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzFDLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksa0NBQWEsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO0lBRWhELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsb0RBQW9ELEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDcEUsUUFBUTtJQUNSLE1BQU0sWUFBWSxHQUFxQixJQUFJLEdBQUcsQ0FBQztRQUM3QyxDQUFDLG1DQUFjLEVBQUU7Z0JBQ2YsTUFBTSxFQUFFLENBQUMsT0FBTyxDQUFDO2FBQ2xCLENBQUM7S0FDSCxDQUFDLENBQUM7SUFDSCxNQUFNLGNBQWMsR0FBRyxNQUFNLElBQUEsd0RBQXlCLEVBQUMsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDakYsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLElBQUEsd0RBQXlCLEVBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBRWxFLE9BQU87SUFDUCxRQUFRLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzVDLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNILFFBQVEsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDMUMsT0FBTyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLElBQUksa0NBQWEsQ0FBQztRQUMvQyxvQkFBb0IsRUFBRSxjQUFjO0tBQ3JDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNWLE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxJQUFJLGtDQUFhLENBQUM7UUFDbEQsb0JBQW9CLEVBQUUsaUJBQWlCO0tBQ3hDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUVWLE9BQU87SUFDUCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2xFLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDMUUsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvb3JkZXIgKi9cbmltcG9ydCAqIGFzIG9zIGZyb20gJ29zJztcbmltcG9ydCAqIGFzIGZzX3BhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgeyBDb25maWd1cmF0aW9uLCBQUk9KRUNUX0NPTkZJRywgUFJPSkVDVF9DT05URVhUIH0gZnJvbSAnLi4vLi4vbGliL2NsaS91c2VyLWNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHsgcGFyc2VDb21tYW5kTGluZUFyZ3VtZW50cyB9IGZyb20gJy4uLy4uL2xpYi9jbGkvcGFyc2UtY29tbWFuZC1saW5lLWFyZ3VtZW50cyc7XG5cbi8vIG1vY2sgZnMgZGVlcGx5XG5qZXN0Lm1vY2soJ2ZzLWV4dHJhJyk7XG5jb25zdCBtb2NrZWRGcyA9IGplc3QubW9ja2VkKGZzLCB7IHNoYWxsb3c6IHRydWUgfSk7XG5cbmNvbnN0IFVTRVJfQ09ORklHID0gZnNfcGF0aC5qb2luKG9zLmhvbWVkaXIoKSwgJy5jZGsuanNvbicpO1xuXG50ZXN0KCdsb2FkIHNldHRpbmdzIGZyb20gYm90aCBmaWxlcyBpZiBhdmFpbGFibGUnLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IEdJVkVOX0NPTkZJRzogTWFwPHN0cmluZywgYW55PiA9IG5ldyBNYXAoW1xuICAgIFtQUk9KRUNUX0NPTkZJRywge1xuICAgICAgcHJvamVjdDogJ2Zvb2JhcicsXG4gICAgfV0sXG4gICAgW1VTRVJfQ09ORklHLCB7XG4gICAgICBwcm9qZWN0OiAnZm9vJyxcbiAgICAgIHRlc3Q6ICdiYXInLFxuICAgIH1dLFxuICBdKTtcblxuICAvLyBXSEVOXG4gIG1vY2tlZEZzLnBhdGhFeGlzdHMubW9ja0ltcGxlbWVudGF0aW9uKHBhdGggPT4ge1xuICAgIHJldHVybiBHSVZFTl9DT05GSUcuaGFzKHBhdGgpO1xuICB9KTtcbiAgbW9ja2VkRnMucmVhZEpTT04ubW9ja0ltcGxlbWVudGF0aW9uKHBhdGggPT4ge1xuICAgIHJldHVybiBHSVZFTl9DT05GSUcuZ2V0KHBhdGgpO1xuICB9KTtcblxuICBjb25zdCBjb25maWcgPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbigpLmxvYWQoKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChjb25maWcuc2V0dGluZ3MuZ2V0KFsncHJvamVjdCddKSkudG9CZSgnZm9vYmFyJyk7XG4gIGV4cGVjdChjb25maWcuc2V0dGluZ3MuZ2V0KFsndGVzdCddKSkudG9CZSgnYmFyJyk7XG59KTtcblxudGVzdCgnbG9hZCBjb250ZXh0IGZyb20gYWxsIDMgZmlsZXMgaWYgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBHSVZFTl9DT05GSUc6IE1hcDxzdHJpbmcsIGFueT4gPSBuZXcgTWFwKFtcbiAgICBbUFJPSkVDVF9DT05GSUcsIHtcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgcHJvamVjdDogJ2Zvb2JhcicsXG4gICAgICB9LFxuICAgIH1dLFxuICAgIFtQUk9KRUNUX0NPTlRFWFQsIHtcbiAgICAgIGZvbzogJ2JhcicsXG4gICAgfV0sXG4gICAgW1VTRVJfQ09ORklHLCB7XG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIHRlc3Q6ICdiYXInLFxuICAgICAgfSxcbiAgICB9XSxcbiAgXSk7XG5cbiAgLy8gV0hFTlxuICBtb2NrZWRGcy5wYXRoRXhpc3RzLm1vY2tJbXBsZW1lbnRhdGlvbihwYXRoID0+IHtcbiAgICByZXR1cm4gR0lWRU5fQ09ORklHLmhhcyhwYXRoKTtcbiAgfSk7XG4gIG1vY2tlZEZzLnJlYWRKU09OLm1vY2tJbXBsZW1lbnRhdGlvbihwYXRoID0+IHtcbiAgICByZXR1cm4gR0lWRU5fQ09ORklHLmdldChwYXRoKTtcbiAgfSk7XG5cbiAgY29uc3QgY29uZmlnID0gYXdhaXQgbmV3IENvbmZpZ3VyYXRpb24oKS5sb2FkKCk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoY29uZmlnLmNvbnRleHQuZ2V0KCdwcm9qZWN0JykpLnRvQmUoJ2Zvb2JhcicpO1xuICBleHBlY3QoY29uZmlnLmNvbnRleHQuZ2V0KCdmb28nKSkudG9CZSgnYmFyJyk7XG4gIGV4cGVjdChjb25maWcuY29udGV4dC5nZXQoJ3Rlc3QnKSkudG9CZSgnYmFyJyk7XG59KTtcblxudGVzdCgndGhyb3dzIGFuIGVycm9yIGlmIHRoZSBgYnVpbGRgIGtleSBpcyBzcGVjaWZpZWQgaW4gdGhlIHVzZXIgY29uZmlnJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBHSVZFTl9DT05GSUc6IE1hcDxzdHJpbmcsIGFueT4gPSBuZXcgTWFwKFtcbiAgICBbVVNFUl9DT05GSUcsIHtcbiAgICAgIGJ1aWxkOiAnZm9vYmFyJyxcbiAgICB9XSxcbiAgXSk7XG5cbiAgLy8gV0hFTlxuICBtb2NrZWRGcy5wYXRoRXhpc3RzLm1vY2tJbXBsZW1lbnRhdGlvbihwYXRoID0+IHtcbiAgICByZXR1cm4gR0lWRU5fQ09ORklHLmhhcyhwYXRoKTtcbiAgfSk7XG4gIG1vY2tlZEZzLnJlYWRKU09OLm1vY2tJbXBsZW1lbnRhdGlvbihwYXRoID0+IHtcbiAgICByZXR1cm4gR0lWRU5fQ09ORklHLmdldChwYXRoKTtcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBhd2FpdCBleHBlY3QobmV3IENvbmZpZ3VyYXRpb24oKS5sb2FkKCkpLnJlamVjdHMudG9FcXVhbChuZXcgRXJyb3IoJ1RoZSBgYnVpbGRgIGtleSBjYW5ub3QgYmUgc3BlY2lmaWVkIGluIHRoZSB1c2VyIGNvbmZpZyAofi8uY2RrLmpzb24pLCBzcGVjaWZ5IGl0IGluIHRoZSBwcm9qZWN0IGNvbmZpZyAoY2RrLmpzb24pIGluc3RlYWQnKSk7XG59KTtcblxudGVzdCgnQ2FuIHNwZWNpZnkgdGhlIGBxdWlldGAga2V5IGluIHRoZSB1c2VyIGNvbmZpZycsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgR0lWRU5fQ09ORklHOiBNYXA8c3RyaW5nLCBhbnk+ID0gbmV3IE1hcChbXG4gICAgW1VTRVJfQ09ORklHLCB7XG4gICAgICBxdWlldDogdHJ1ZSxcbiAgICB9XSxcbiAgXSk7XG5cbiAgLy8gV0hFTlxuICBtb2NrZWRGcy5wYXRoRXhpc3RzLm1vY2tJbXBsZW1lbnRhdGlvbihwYXRoID0+IHtcbiAgICByZXR1cm4gR0lWRU5fQ09ORklHLmhhcyhwYXRoKTtcbiAgfSk7XG4gIG1vY2tlZEZzLnJlYWRKU09OLm1vY2tJbXBsZW1lbnRhdGlvbihwYXRoID0+IHtcbiAgICByZXR1cm4gR0lWRU5fQ09ORklHLmdldChwYXRoKTtcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBjb25zdCBjb25maWcgPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbigpLmxvYWQoKTtcblxuICBleHBlY3QoY29uZmlnLnNldHRpbmdzLmdldChbJ3F1aWV0J10pKS50b0JlKHRydWUpO1xufSk7XG5cbnRlc3QoJ2FycmF5IHNldHRpbmdzIGFyZSBub3Qgb3ZlcnJpZGRlbiBieSB5YXJnIGRlZmF1bHRzJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBHSVZFTl9DT05GSUc6IE1hcDxzdHJpbmcsIGFueT4gPSBuZXcgTWFwKFtcbiAgICBbUFJPSkVDVF9DT05GSUcsIHtcbiAgICAgIHBsdWdpbjogWydkdW1teSddLFxuICAgIH1dLFxuICBdKTtcbiAgY29uc3QgYXJnc1dpdGhQbHVnaW4gPSBhd2FpdCBwYXJzZUNvbW1hbmRMaW5lQXJndW1lbnRzKFsnbHMnLCAnLS1wbHVnaW4nLCAnW10nXSk7XG4gIGNvbnN0IGFyZ3NXaXRob3V0UGx1Z2luID0gYXdhaXQgcGFyc2VDb21tYW5kTGluZUFyZ3VtZW50cyhbJ2xzJ10pO1xuXG4gIC8vIFdIRU5cbiAgbW9ja2VkRnMucGF0aEV4aXN0cy5tb2NrSW1wbGVtZW50YXRpb24ocGF0aCA9PiB7XG4gICAgcmV0dXJuIEdJVkVOX0NPTkZJRy5oYXMocGF0aCk7XG4gIH0pO1xuICBtb2NrZWRGcy5yZWFkSlNPTi5tb2NrSW1wbGVtZW50YXRpb24ocGF0aCA9PiB7XG4gICAgcmV0dXJuIEdJVkVOX0NPTkZJRy5nZXQocGF0aCk7XG4gIH0pO1xuXG4gIGNvbnN0IGNvbmZpZ1dpdGhQbHVnaW4gPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbih7XG4gICAgY29tbWFuZExpbmVBcmd1bWVudHM6IGFyZ3NXaXRoUGx1Z2luLFxuICB9KS5sb2FkKCk7XG4gIGNvbnN0IGNvbmZpZ1dpdGhvdXRQbHVnaW4gPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbih7XG4gICAgY29tbWFuZExpbmVBcmd1bWVudHM6IGFyZ3NXaXRob3V0UGx1Z2luLFxuICB9KS5sb2FkKCk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoY29uZmlnV2l0aFBsdWdpbi5zZXR0aW5ncy5nZXQoWydwbHVnaW4nXSkpLnRvRXF1YWwoWydbXSddKTtcbiAgZXhwZWN0KGNvbmZpZ1dpdGhvdXRQbHVnaW4uc2V0dGluZ3MuZ2V0KFsncGx1Z2luJ10pKS50b0VxdWFsKFsnZHVtbXknXSk7XG59KTtcbiJdfQ==