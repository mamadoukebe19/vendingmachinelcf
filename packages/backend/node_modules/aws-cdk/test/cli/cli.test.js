"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cli_1 = require("../../lib/cli/cli");
const cli_io_host_1 = require("../../lib/toolkit/cli-io-host");
// Store original version module exports so we don't conflict with other tests
const originalVersion = jest.requireActual('../../lib/cli/version');
// Mock the dependencies
jest.mock('../../lib/logging', () => ({
    debug: jest.fn(),
    error: jest.fn(),
    print: jest.fn(),
    result: jest.fn(),
}));
jest.mock('@aws-cdk/cx-api');
jest.mock('@jsii/check-node/run');
jest.mock('../../lib/cli/platform-warnings', () => ({
    checkForPlatformWarnings: jest.fn().mockResolvedValue(undefined),
}));
jest.mock('../../lib/cli/user-configuration', () => ({
    Configuration: jest.fn().mockImplementation(() => ({
        load: jest.fn().mockResolvedValue(undefined),
        settings: {
            get: jest.fn().mockReturnValue(undefined),
        },
        context: {
            get: jest.fn().mockReturnValue([]),
        },
    })),
}));
jest.mock('../../lib/notices', () => ({
    Notices: {
        create: jest.fn().mockReturnValue({
            refresh: jest.fn().mockResolvedValue(undefined),
            display: jest.fn(),
        }),
    },
}));
jest.mock('../../lib/cli/parse-command-line-arguments', () => ({
    parseCommandLineArguments: jest.fn().mockImplementation((args) => Promise.resolve({
        _: ['version'],
        verbose: args.includes('-v') ? (args.filter((arg) => arg === '-v').length) : args.includes('--verbose') ? (parseInt(args[args.indexOf('--verbose') + 1]) || true) : undefined,
    })),
}));
describe('exec verbose flag tests', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        // Set up version module for our tests
        jest.mock('../../lib/cli/version', () => ({
            ...originalVersion,
            DISPLAY_VERSION: 'test-version',
            displayVersionMessage: jest.fn().mockResolvedValue(undefined),
        }));
    });
    afterEach(() => {
        // Restore the version module to its original state
        jest.resetModules();
        jest.setMock('../../lib/cli/version', originalVersion);
    });
    test('should not set log level when no verbose flag is present', async () => {
        await (0, cli_1.exec)(['version']);
        expect(cli_io_host_1.CliIoHost.instance().logLevel).toBe('info');
    });
    test('should set DEBUG level with single -v flag', async () => {
        await (0, cli_1.exec)(['-v', 'version']);
        expect(cli_io_host_1.CliIoHost.instance().logLevel).toBe('debug');
    });
    test('should set TRACE level with double -v flag', async () => {
        await (0, cli_1.exec)(['-v', '-v', 'version']);
        expect(cli_io_host_1.CliIoHost.instance().logLevel).toBe('trace');
    });
    test('should set DEBUG level with --verbose=1', async () => {
        await (0, cli_1.exec)(['--verbose', '1', 'version']);
        expect(cli_io_host_1.CliIoHost.instance().logLevel).toBe('debug');
    });
    test('should set TRACE level with --verbose=2', async () => {
        await (0, cli_1.exec)(['--verbose', '2', 'version']);
        expect(cli_io_host_1.CliIoHost.instance().logLevel).toBe('trace');
    });
    test('should set TRACE level with verbose level > 2', async () => {
        await (0, cli_1.exec)(['--verbose', '3', 'version']);
        expect(cli_io_host_1.CliIoHost.instance().logLevel).toBe('trace');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjbGkudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDJDQUF5QztBQUN6QywrREFBMEQ7QUFFMUQsOEVBQThFO0FBQzlFLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUVwRSx3QkFBd0I7QUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ2xCLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDbEQsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQztDQUNqRSxDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuRCxhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDakQsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUM7UUFDNUMsUUFBUSxFQUFFO1lBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFF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dGVudCI6WyJpbXBvcnQgeyBleGVjIH0gZnJvbSAnLi4vLi4vbGliL2NsaS9jbGknO1xuaW1wb3J0IHsgQ2xpSW9Ib3N0IH0gZnJvbSAnLi4vLi4vbGliL3Rvb2xraXQvY2xpLWlvLWhvc3QnO1xuXG4vLyBTdG9yZSBvcmlnaW5hbCB2ZXJzaW9uIG1vZHVsZSBleHBvcnRzIHNvIHdlIGRvbid0IGNvbmZsaWN0IHdpdGggb3RoZXIgdGVzdHNcbmNvbnN0IG9yaWdpbmFsVmVyc2lvbiA9IGplc3QucmVxdWlyZUFjdHVhbCgnLi4vLi4vbGliL2NsaS92ZXJzaW9uJyk7XG5cbi8vIE1vY2sgdGhlIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCcuLi8uLi9saWIvbG9nZ2luZycsICgpID0+ICh7XG4gIGRlYnVnOiBqZXN0LmZuKCksXG4gIGVycm9yOiBqZXN0LmZuKCksXG4gIHByaW50OiBqZXN0LmZuKCksXG4gIHJlc3VsdDogamVzdC5mbigpLFxufSkpO1xuXG5qZXN0Lm1vY2soJ0Bhd3MtY2RrL2N4LWFwaScpO1xuamVzdC5tb2NrKCdAanNpaS9jaGVjay1ub2RlL3J1bicpO1xuamVzdC5tb2NrKCcuLi8uLi9saWIvY2xpL3BsYXRmb3JtLXdhcm5pbmdzJywgKCkgPT4gKHtcbiAgY2hlY2tGb3JQbGF0Zm9ybVdhcm5pbmdzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbn0pKTtcblxuamVzdC5tb2NrKCcuLi8uLi9saWIvY2xpL3VzZXItY29uZmlndXJhdGlvbicsICgpID0+ICh7XG4gIENvbmZpZ3VyYXRpb246IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBsb2FkOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICBzZXR0aW5nczoge1xuICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCksXG4gICAgfSxcbiAgICBjb250ZXh0OiB7XG4gICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoW10pLFxuICAgIH0sXG4gIH0pKSxcbn0pKTtcblxuamVzdC5tb2NrKCcuLi8uLi9saWIvbm90aWNlcycsICgpID0+ICh7XG4gIE5vdGljZXM6IHtcbiAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgcmVmcmVzaDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICBkaXNwbGF5OiBqZXN0LmZuKCksXG4gICAgfSksXG4gIH0sXG59KSk7XG5cbmplc3QubW9jaygnLi4vLi4vbGliL2NsaS9wYXJzZS1jb21tYW5kLWxpbmUtYXJndW1lbnRzJywgKCkgPT4gKHtcbiAgcGFyc2VDb21tYW5kTGluZUFyZ3VtZW50czogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoYXJncykgPT4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICBfOiBbJ3ZlcnNpb24nXSxcbiAgICB2ZXJib3NlOiBhcmdzLmluY2x1ZGVzKCctdicpID8gKFxuICAgICAgYXJncy5maWx0ZXIoKGFyZzogc3RyaW5nKSA9PiBhcmcgPT09ICctdicpLmxlbmd0aFxuICAgICkgOiBhcmdzLmluY2x1ZGVzKCctLXZlcmJvc2UnKSA/IChcbiAgICAgIHBhcnNlSW50KGFyZ3NbYXJncy5pbmRleE9mKCctLXZlcmJvc2UnKSArIDFdKSB8fCB0cnVlXG4gICAgKSA6IHVuZGVmaW5lZCxcbiAgfSkpLFxufSkpO1xuXG5kZXNjcmliZSgnZXhlYyB2ZXJib3NlIGZsYWcgdGVzdHMnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIC8vIFNldCB1cCB2ZXJzaW9uIG1vZHVsZSBmb3Igb3VyIHRlc3RzXG4gICAgamVzdC5tb2NrKCcuLi8uLi9saWIvY2xpL3ZlcnNpb24nLCAoKSA9PiAoe1xuICAgICAgLi4ub3JpZ2luYWxWZXJzaW9uLFxuICAgICAgRElTUExBWV9WRVJTSU9OOiAndGVzdC12ZXJzaW9uJyxcbiAgICAgIGRpc3BsYXlWZXJzaW9uTWVzc2FnZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgfSkpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIC8vIFJlc3RvcmUgdGhlIHZlcnNpb24gbW9kdWxlIHRvIGl0cyBvcmlnaW5hbCBzdGF0ZVxuICAgIGplc3QucmVzZXRNb2R1bGVzKCk7XG4gICAgamVzdC5zZXRNb2NrKCcuLi8uLi9saWIvY2xpL3ZlcnNpb24nLCBvcmlnaW5hbFZlcnNpb24pO1xuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgbm90IHNldCBsb2cgbGV2ZWwgd2hlbiBubyB2ZXJib3NlIGZsYWcgaXMgcHJlc2VudCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBleGVjKFsndmVyc2lvbiddKTtcbiAgICBleHBlY3QoQ2xpSW9Ib3N0Lmluc3RhbmNlKCkubG9nTGV2ZWwpLnRvQmUoJ2luZm8nKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHNldCBERUJVRyBsZXZlbCB3aXRoIHNpbmdsZSAtdiBmbGFnJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyctdicsICd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChDbGlJb0hvc3QuaW5zdGFuY2UoKS5sb2dMZXZlbCkudG9CZSgnZGVidWcnKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHNldCBUUkFDRSBsZXZlbCB3aXRoIGRvdWJsZSAtdiBmbGFnJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyctdicsICctdicsICd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChDbGlJb0hvc3QuaW5zdGFuY2UoKS5sb2dMZXZlbCkudG9CZSgndHJhY2UnKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHNldCBERUJVRyBsZXZlbCB3aXRoIC0tdmVyYm9zZT0xJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyctLXZlcmJvc2UnLCAnMScsICd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChDbGlJb0hvc3QuaW5zdGFuY2UoKS5sb2dMZXZlbCkudG9CZSgnZGVidWcnKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHNldCBUUkFDRSBsZXZlbCB3aXRoIC0tdmVyYm9zZT0yJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyctLXZlcmJvc2UnLCAnMicsICd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChDbGlJb0hvc3QuaW5zdGFuY2UoKS5sb2dMZXZlbCkudG9CZSgndHJhY2UnKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHNldCBUUkFDRSBsZXZlbCB3aXRoIHZlcmJvc2UgbGV2ZWwgPiAyJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyctLXZlcmJvc2UnLCAnMycsICd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChDbGlJb0hvc3QuaW5zdGFuY2UoKS5sb2dMZXZlbCkudG9CZSgndHJhY2UnKTtcbiAgfSk7XG59KTtcbiJdfQ==