"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const logging_1 = require("../../../lib/logging");
const cli_io_host_1 = require("../../../lib/toolkit/cli-io-host");
describe('logging', () => {
    const ioHost = cli_io_host_1.CliIoHost.instance({}, true);
    let mockStdout;
    let mockStderr;
    const stripAnsi = (str) => {
        const ansiRegex = /\u001b\[[0-9;]*[a-zA-Z]/g;
        return str.replace(ansiRegex, '');
    };
    beforeEach(() => {
        ioHost.logLevel = 'info';
        ioHost.isCI = false;
        mockStdout = jest.fn();
        mockStderr = jest.fn();
        jest.spyOn(process.stdout, 'write').mockImplementation((chunk) => {
            mockStdout(stripAnsi(chunk.toString()));
            return true;
        });
        jest.spyOn(process.stderr, 'write').mockImplementation((chunk) => {
            mockStderr(stripAnsi(chunk.toString()));
            return true;
        });
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    describe('stream selection', () => {
        test('result() always writes to stdout with both styles', () => {
            // String style
            (0, logging_1.result)('test message');
            expect(mockStdout).toHaveBeenCalledWith('test message\n');
            // Object style
            (0, logging_1.result)({ message: 'test message 2' });
            expect(mockStdout).toHaveBeenCalledWith('test message 2\n');
            expect(mockStderr).not.toHaveBeenCalled();
        });
        test('error() always writes to stderr with both styles', () => {
            // String style
            (0, logging_1.error)('test error');
            expect(mockStderr).toHaveBeenCalledWith('test error\n');
            // Object style
            (0, logging_1.error)({ message: 'test error 2' });
            expect(mockStderr).toHaveBeenCalledWith('test error 2\n');
            expect(mockStdout).not.toHaveBeenCalled();
        });
        test('info() writes to stderr by default with both styles', () => {
            // String style
            (0, logging_1.info)('test print');
            expect(mockStderr).toHaveBeenCalledWith('test print\n');
            // Object style
            (0, logging_1.info)({ message: 'test print 2' });
            expect(mockStderr).toHaveBeenCalledWith('test print 2\n');
            expect(mockStdout).not.toHaveBeenCalled();
        });
        test('info() writes to stdout in CI mode with both styles', () => {
            ioHost.isCI = true;
            // String style
            (0, logging_1.info)('test print');
            expect(mockStdout).toHaveBeenCalledWith('test print\n');
            // Object style
            (0, logging_1.info)({ message: 'test print 2' });
            expect(mockStdout).toHaveBeenCalledWith('test print 2\n');
            expect(mockStderr).not.toHaveBeenCalled();
        });
    });
    describe('log levels', () => {
        test('respects log level settings with both styles', () => {
            ioHost.logLevel = 'error';
            // String style
            (0, logging_1.error)('error message');
            (0, logging_1.warning)('warning message');
            (0, logging_1.info)('print message');
            // Object style
            (0, logging_1.error)({ message: 'error message 2' });
            (0, logging_1.warning)({ message: 'warning message 2' });
            (0, logging_1.info)({ message: 'print message 2' });
            expect(mockStderr).toHaveBeenCalledWith('error message\n');
            expect(mockStderr).toHaveBeenCalledWith('error message 2\n');
            expect(mockStderr).not.toHaveBeenCalledWith('warning message\n');
            expect(mockStderr).not.toHaveBeenCalledWith('warning message 2\n');
            expect(mockStderr).not.toHaveBeenCalledWith('print message\n');
            expect(mockStderr).not.toHaveBeenCalledWith('print message 2\n');
        });
        test('debug messages only show at debug level with both styles', () => {
            ioHost.logLevel = 'info';
            (0, logging_1.debug)('debug message');
            (0, logging_1.debug)({ message: 'debug message 2' });
            expect(mockStderr).not.toHaveBeenCalled();
            ioHost.logLevel = 'debug';
            (0, logging_1.debug)('debug message');
            (0, logging_1.debug)({ message: 'debug message 2' });
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] debug message\n$/));
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] debug message 2\n$/));
        });
        test('trace messages only show at trace level with both styles', () => {
            ioHost.logLevel = 'debug';
            (0, logging_1.trace)('trace message');
            (0, logging_1.trace)({ message: 'trace message 2' });
            expect(mockStderr).not.toHaveBeenCalled();
            ioHost.logLevel = 'trace';
            (0, logging_1.trace)('trace message');
            (0, logging_1.trace)({ message: 'trace message 2' });
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] trace message\n$/));
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] trace message 2\n$/));
        });
    });
    describe('formatted messages', () => {
        test('handles format strings correctly with both styles', () => {
            // String style
            (0, logging_1.info)('Hello %s, you have %d messages', 'User', 5);
            expect(mockStderr).toHaveBeenCalledWith('Hello User, you have 5 messages\n');
            // Object style
            (0, logging_1.info)({ message: 'Hello %s, you have %d messages' }, 'User', 5);
            expect(mockStderr).toHaveBeenCalledWith('Hello User, you have 5 messages\n');
        });
        test('handles objects in format strings with both styles', () => {
            const obj = { name: 'test' };
            // String style
            (0, logging_1.info)('Object: %j', obj);
            expect(mockStderr).toHaveBeenCalledWith('Object: {"name":"test"}\n');
            // Object style
            (0, logging_1.info)({ message: 'Object: %j' }, obj);
            expect(mockStderr).toHaveBeenCalledWith('Object: {"name":"test"}\n');
        });
        test('handles multiple style changes in single call', () => {
            const obj = { id: 123 };
            (0, logging_1.success)('Processing %s: %j at %d%%', 'task', obj, 50);
            expect(mockStderr).toHaveBeenCalledWith('Processing task: {"id":123} at 50%\n');
        });
    });
    describe('styled output', () => {
        test('success() adds green color to output with both styles', () => {
            // String style
            (0, logging_1.success)('operation completed');
            expect(mockStderr).toHaveBeenCalledWith('operation completed\n');
            // Object style
            (0, logging_1.success)({ message: 'operation completed 2' });
            expect(mockStderr).toHaveBeenCalledWith('operation completed 2\n');
        });
        test('highlight() adds bold formatting to output with both styles', () => {
            // String style
            (0, logging_1.highlight)('important message');
            expect(mockStderr).toHaveBeenCalledWith('important message\n');
            // Object style
            (0, logging_1.highlight)({ message: 'important message 2' });
            expect(mockStderr).toHaveBeenCalledWith('important message 2\n');
        });
        test('success handles format strings with styling', () => {
            (0, logging_1.success)('completed task %d of %d', 1, 3);
            expect(mockStderr).toHaveBeenCalledWith('completed task 1 of 3\n');
            // Remove the code from the test since it's an implementation detail
            (0, logging_1.success)({ message: 'completed task %d of %d' }, 2, 3);
            expect(mockStderr).toHaveBeenCalledWith('completed task 2 of 3\n');
        });
        test('highlight handles complex objects with styling', () => {
            const complexObj = { status: 'active', count: 42 };
            (0, logging_1.highlight)('Status: %j', complexObj);
            expect(mockStderr).toHaveBeenCalledWith('Status: {"status":"active","count":42}\n');
            // Remove the code from the test since it's an implementation detail
            (0, logging_1.highlight)({ message: 'Status: %j' }, complexObj);
            expect(mockStderr).toHaveBeenCalledWith('Status: {"status":"active","count":42}\n');
        });
    });
    describe('edge cases', () => {
        test('handles null and undefined arguments with both styles', () => {
            // String style
            (0, logging_1.info)('Values: %s, %s', null, undefined);
            expect(mockStderr).toHaveBeenCalledWith('Values: null, undefined\n');
            // Object style
            (0, logging_1.info)({ message: 'Values: %s, %s' }, null, undefined);
            expect(mockStderr).toHaveBeenCalledWith('Values: null, undefined\n');
        });
        test('handles circular references in objects with both styles', () => {
            const obj = { name: 'test' };
            obj.self = obj;
            // String style
            (0, logging_1.info)('Object: %j', obj);
            expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('[Circular'));
            // Object style
            (0, logging_1.info)({ message: 'Object: %j' }, obj);
            expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('[Circular'));
        });
    });
    describe('message codes', () => {
        test('validates message codes correctly', () => {
            // Valid codes
            expect(() => (0, logging_1.error)({ message: 'test', code: 'CDK_TOOLKIT_E0001' })).not.toThrow();
            expect(() => (0, logging_1.warning)({ message: 'test', code: 'CDK_ASSETS_W4999' })).not.toThrow();
            expect(() => (0, logging_1.info)({ message: 'test', code: 'CDK_SDK_I0000' })).not.toThrow();
        });
        test('uses default codes when none provided', () => {
            (0, logging_1.error)('test error');
            expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('test error'));
            // Would need to modify the code to expose the actual message code for verification
        });
    });
    describe('CI mode behavior', () => {
        test('correctly switches between stdout and stderr based on CI mode', () => {
            ioHost.isCI = true;
            (0, logging_1.warning)('warning in CI');
            (0, logging_1.success)('success in CI');
            (0, logging_1.error)('error in CI');
            expect(mockStdout).toHaveBeenCalledWith('warning in CI\n');
            expect(mockStdout).toHaveBeenCalledWith('success in CI\n');
            expect(mockStderr).toHaveBeenCalledWith('error in CI\n');
            ioHost.isCI = false;
            (0, logging_1.warning)('warning not in CI');
            (0, logging_1.success)('success not in CI');
            (0, logging_1.error)('error not in CI');
            expect(mockStderr).toHaveBeenCalledWith('warning not in CI\n');
            expect(mockStderr).toHaveBeenCalledWith('success not in CI\n');
            expect(mockStderr).toHaveBeenCalledWith('error not in CI\n');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2luZy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9nZ2luZy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0RBQXNHO0FBQ3RHLGtFQUE2RDtBQUU3RCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtJQUN2QixNQUFNLE1BQU0sR0FBRyx1QkFBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDNUMsSUFBSSxVQUFxQixDQUFDO0lBQzFCLElBQUksVUFBcUIsQ0FBQztJQUUxQixNQUFNLFNBQVMsR0FBRyxDQUFDLEdBQVcsRUFBVSxFQUFFO1FBQ3hDLE1BQU0sU0FBUyxHQUFHLDBCQUEwQixDQUFDO1FBQzdDLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0lBRUYsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLE1BQU0sQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBRXBCLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDdkIsVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUV2QixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFVLEVBQUUsRUFBRTtZQUNwRSxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDeEMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFO1lBQ3BFLFVB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QUMsb0JBQW9CLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUMvRCxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsb0JBQW9CLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUMvRCxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsb0JBQW9CLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZXN1bHQsIHN1Y2Nlc3MsIGhpZ2hsaWdodCwgZXJyb3IsIHdhcm5pbmcsIGluZm8sIGRlYnVnLCB0cmFjZSB9IGZyb20gJy4uLy4uLy4uL2xpYi9sb2dnaW5nJztcbmltcG9ydCB7IENsaUlvSG9zdCB9IGZyb20gJy4uLy4uLy4uL2xpYi90b29sa2l0L2NsaS1pby1ob3N0JztcblxuZGVzY3JpYmUoJ2xvZ2dpbmcnLCAoKSA9PiB7XG4gIGNvbnN0IGlvSG9zdCA9IENsaUlvSG9zdC5pbnN0YW5jZSh7fSwgdHJ1ZSk7XG4gIGxldCBtb2NrU3Rkb3V0OiBqZXN0Lk1vY2s7XG4gIGxldCBtb2NrU3RkZXJyOiBqZXN0Lk1vY2s7XG5cbiAgY29uc3Qgc3RyaXBBbnNpID0gKHN0cjogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBhbnNpUmVnZXggPSAvXFx1MDAxYlxcW1swLTk7XSpbYS16QS1aXS9nO1xuICAgIHJldHVybiBzdHIucmVwbGFjZShhbnNpUmVnZXgsICcnKTtcbiAgfTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBpb0hvc3QubG9nTGV2ZWwgPSAnaW5mbyc7XG4gICAgaW9Ib3N0LmlzQ0kgPSBmYWxzZTtcblxuICAgIG1vY2tTdGRvdXQgPSBqZXN0LmZuKCk7XG4gICAgbW9ja1N0ZGVyciA9IGplc3QuZm4oKTtcblxuICAgIGplc3Quc3B5T24ocHJvY2Vzcy5zdGRvdXQsICd3cml0ZScpLm1vY2tJbXBsZW1lbnRhdGlvbigoY2h1bms6IGFueSkgPT4ge1xuICAgICAgbW9ja1N0ZG91dChzdHJpcEFuc2koY2h1bmsudG9TdHJpbmcoKSkpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG5cbiAgICBqZXN0LnNweU9uKHByb2Nlc3Muc3RkZXJyLCAnd3JpdGUnKS5tb2NrSW1wbGVtZW50YXRpb24oKGNodW5rOiBhbnkpID0+IHtcbiAgICAgIG1vY2tTdGRlcnIoc3RyaXBBbnNpKGNodW5rLnRvU3RyaW5nKCkpKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdHJlYW0gc2VsZWN0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Jlc3VsdCgpIGFsd2F5cyB3cml0ZXMgdG8gc3Rkb3V0IHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICAvLyBTdHJpbmcgc3R5bGVcbiAgICAgIHJlc3VsdCgndGVzdCBtZXNzYWdlJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZG91dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QgbWVzc2FnZVxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIHJlc3VsdCh7IG1lc3NhZ2U6ICd0ZXN0IG1lc3NhZ2UgMicgfSk7XG4gICAgICBleHBlY3QobW9ja1N0ZG91dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QgbWVzc2FnZSAyXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2Vycm9yKCkgYWx3YXlzIHdyaXRlcyB0byBzdGRlcnIgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgZXJyb3IoJ3Rlc3QgZXJyb3InKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdCBlcnJvclxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGVycm9yKHsgbWVzc2FnZTogJ3Rlc3QgZXJyb3IgMicgfSk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QgZXJyb3IgMlxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdpbmZvKCkgd3JpdGVzIHRvIHN0ZGVyciBieSBkZWZhdWx0IHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICAvLyBTdHJpbmcgc3R5bGVcbiAgICAgIGluZm8oJ3Rlc3QgcHJpbnQnKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdCBwcmludFxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGluZm8oeyBtZXNzYWdlOiAndGVzdCBwcmludCAyJyB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGVzdCBwcmludCAyXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZG91dCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2luZm8oKSB3cml0ZXMgdG8gc3Rkb3V0IGluIENJIG1vZGUgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIGlvSG9zdC5pc0NJID0gdHJ1ZTtcbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgaW5mbygndGVzdCBwcmludCcpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0IHByaW50XFxuJyk7XG5cbiAgICAgIC8vIE9iamVjdCBzdHlsZVxuICAgICAgaW5mbyh7IG1lc3NhZ2U6ICd0ZXN0IHByaW50IDInIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0IHByaW50IDJcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbG9nIGxldmVscycsICgpID0+IHtcbiAgICB0ZXN0KCdyZXNwZWN0cyBsb2cgbGV2ZWwgc2V0dGluZ3Mgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIGlvSG9zdC5sb2dMZXZlbCA9ICdlcnJvcic7XG5cbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgZXJyb3IoJ2Vycm9yIG1lc3NhZ2UnKTtcbiAgICAgIHdhcm5pbmcoJ3dhcm5pbmcgbWVzc2FnZScpO1xuICAgICAgaW5mbygncHJpbnQgbWVzc2FnZScpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGVycm9yKHsgbWVzc2FnZTogJ2Vycm9yIG1lc3NhZ2UgMicgfSk7XG4gICAgICB3YXJuaW5nKHsgbWVzc2FnZTogJ3dhcm5pbmcgbWVzc2FnZSAyJyB9KTtcbiAgICAgIGluZm8oeyBtZXNzYWdlOiAncHJpbnQgbWVzc2FnZSAyJyB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdlcnJvciBtZXNzYWdlXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2Vycm9yIG1lc3NhZ2UgMlxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnd2FybmluZyBtZXNzYWdlXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd3YXJuaW5nIG1lc3NhZ2UgMlxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncHJpbnQgbWVzc2FnZVxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncHJpbnQgbWVzc2FnZSAyXFxuJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdkZWJ1ZyBtZXNzYWdlcyBvbmx5IHNob3cgYXQgZGVidWcgbGV2ZWwgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIGlvSG9zdC5sb2dMZXZlbCA9ICdpbmZvJztcbiAgICAgIGRlYnVnKCdkZWJ1ZyBtZXNzYWdlJyk7XG4gICAgICBkZWJ1Zyh7IG1lc3NhZ2U6ICdkZWJ1ZyBtZXNzYWdlIDInIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cbiAgICAgIGlvSG9zdC5sb2dMZXZlbCA9ICdkZWJ1Zyc7XG4gICAgICBkZWJ1ZygnZGVidWcgbWVzc2FnZScpO1xuICAgICAgZGVidWcoeyBtZXNzYWdlOiAnZGVidWcgbWVzc2FnZSAyJyB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9eXFxbXFxkezJ9OlxcZHsyfTpcXGR7Mn1cXF0gZGVidWcgbWVzc2FnZVxcbiQvKSxcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdNYXRjaGluZygvXlxcW1xcZHsyfTpcXGR7Mn06XFxkezJ9XFxdIGRlYnVnIG1lc3NhZ2UgMlxcbiQvKSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd0cmFjZSBtZXNzYWdlcyBvbmx5IHNob3cgYXQgdHJhY2UgbGV2ZWwgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIGlvSG9zdC5sb2dMZXZlbCA9ICdkZWJ1Zyc7XG4gICAgICB0cmFjZSgndHJhY2UgbWVzc2FnZScpO1xuICAgICAgdHJhY2UoeyBtZXNzYWdlOiAndHJhY2UgbWVzc2FnZSAyJyB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgICBpb0hvc3QubG9nTGV2ZWwgPSAndHJhY2UnO1xuICAgICAgdHJhY2UoJ3RyYWNlIG1lc3NhZ2UnKTtcbiAgICAgIHRyYWNlKHsgbWVzc2FnZTogJ3RyYWNlIG1lc3NhZ2UgMicgfSk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdNYXRjaGluZygvXlxcW1xcZHsyfTpcXGR7Mn06XFxkezJ9XFxdIHRyYWNlIG1lc3NhZ2VcXG4kLyksXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoL15cXFtcXGR7Mn06XFxkezJ9OlxcZHsyfVxcXSB0cmFjZSBtZXNzYWdlIDJcXG4kLyksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZm9ybWF0dGVkIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgIHRlc3QoJ2hhbmRsZXMgZm9ybWF0IHN0cmluZ3MgY29ycmVjdGx5IHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICAvLyBTdHJpbmcgc3R5bGVcbiAgICAgIGluZm8oJ0hlbGxvICVzLCB5b3UgaGF2ZSAlZCBtZXNzYWdlcycsICdVc2VyJywgNSk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0hlbGxvIFVzZXIsIHlvdSBoYXZlIDUgbWVzc2FnZXNcXG4nKTtcblxuICAgICAgLy8gT2JqZWN0IHN0eWxlXG4gICAgICBpbmZvKHsgbWVzc2FnZTogJ0hlbGxvICVzLCB5b3UgaGF2ZSAlZCBtZXNzYWdlcycgfSwgJ1VzZXInLCA1KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnSGVsbG8gVXNlciwgeW91IGhhdmUgNSBtZXNzYWdlc1xcbicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnaGFuZGxlcyBvYmplY3RzIGluIGZvcm1hdCBzdHJpbmdzIHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBvYmogPSB7IG5hbWU6ICd0ZXN0JyB9O1xuICAgICAgLy8gU3RyaW5nIHN0eWxlXG4gICAgICBpbmZvKCdPYmplY3Q6ICVqJywgb2JqKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnT2JqZWN0OiB7XCJuYW1lXCI6XCJ0ZXN0XCJ9XFxuJyk7XG5cbiAgICAgIC8vIE9iamVjdCBzdHlsZVxuICAgICAgaW5mbyh7IG1lc3NhZ2U6ICdPYmplY3Q6ICVqJyB9LCBvYmopO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdPYmplY3Q6IHtcIm5hbWVcIjpcInRlc3RcIn1cXG4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2hhbmRsZXMgbXVsdGlwbGUgc3R5bGUgY2hhbmdlcyBpbiBzaW5nbGUgY2FsbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG9iaiA9IHsgaWQ6IDEyMyB9O1xuICAgICAgc3VjY2VzcygnUHJvY2Vzc2luZyAlczogJWogYXQgJWQlJScsICd0YXNrJywgb2JqLCA1MCk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdQcm9jZXNzaW5nIHRhc2s6IHtcImlkXCI6MTIzfSBhdCA1MCVcXG4nLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0eWxlZCBvdXRwdXQnLCAoKSA9PiB7XG4gICAgdGVzdCgnc3VjY2VzcygpIGFkZHMgZ3JlZW4gY29sb3IgdG8gb3V0cHV0IHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICAvLyBTdHJpbmcgc3R5bGVcbiAgICAgIHN1Y2Nlc3MoJ29wZXJhdGlvbiBjb21wbGV0ZWQnKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnb3BlcmF0aW9uIGNvbXBsZXRlZFxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIHN1Y2Nlc3MoeyBtZXNzYWdlOiAnb3BlcmF0aW9uIGNvbXBsZXRlZCAyJyB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnb3BlcmF0aW9uIGNvbXBsZXRlZCAyXFxuJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdoaWdobGlnaHQoKSBhZGRzIGJvbGQgZm9ybWF0dGluZyB0byBvdXRwdXQgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgaGlnaGxpZ2h0KCdpbXBvcnRhbnQgbWVzc2FnZScpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpbXBvcnRhbnQgbWVzc2FnZVxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGhpZ2hsaWdodCh7IG1lc3NhZ2U6ICdpbXBvcnRhbnQgbWVzc2FnZSAyJyB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaW1wb3J0YW50IG1lc3NhZ2UgMlxcbicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc3VjY2VzcyBoYW5kbGVzIGZvcm1hdCBzdHJpbmdzIHdpdGggc3R5bGluZycsICgpID0+IHtcbiAgICAgIHN1Y2Nlc3MoJ2NvbXBsZXRlZCB0YXNrICVkIG9mICVkJywgMSwgMyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NvbXBsZXRlZCB0YXNrIDEgb2YgM1xcbicpO1xuXG4gICAgICAvLyBSZW1vdmUgdGhlIGNvZGUgZnJvbSB0aGUgdGVzdCBzaW5jZSBpdCdzIGFuIGltcGxlbWVudGF0aW9uIGRldGFpbFxuICAgICAgc3VjY2Vzcyh7IG1lc3NhZ2U6ICdjb21wbGV0ZWQgdGFzayAlZCBvZiAlZCcgfSwgMiwgMyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NvbXBsZXRlZCB0YXNrIDIgb2YgM1xcbicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnaGlnaGxpZ2h0IGhhbmRsZXMgY29tcGxleCBvYmplY3RzIHdpdGggc3R5bGluZycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbXBsZXhPYmogPSB7IHN0YXR1czogJ2FjdGl2ZScsIGNvdW50OiA0MiB9O1xuICAgICAgaGlnaGxpZ2h0KCdTdGF0dXM6ICVqJywgY29tcGxleE9iaik7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1N0YXR1czoge1wic3RhdHVzXCI6XCJhY3RpdmVcIixcImNvdW50XCI6NDJ9XFxuJyk7XG5cbiAgICAgIC8vIFJlbW92ZSB0aGUgY29kZSBmcm9tIHRoZSB0ZXN0IHNpbmNlIGl0J3MgYW4gaW1wbGVtZW50YXRpb24gZGV0YWlsXG4gICAgICBoaWdobGlnaHQoeyBtZXNzYWdlOiAnU3RhdHVzOiAlaicgfSwgY29tcGxleE9iaik7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1N0YXR1czoge1wic3RhdHVzXCI6XCJhY3RpdmVcIixcImNvdW50XCI6NDJ9XFxuJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlZGdlIGNhc2VzJywgKCkgPT4ge1xuICAgIHRlc3QoJ2hhbmRsZXMgbnVsbCBhbmQgdW5kZWZpbmVkIGFyZ3VtZW50cyB3aXRoIGJvdGggc3R5bGVzJywgKCkgPT4ge1xuICAgICAgLy8gU3RyaW5nIHN0eWxlXG4gICAgICBpbmZvKCdWYWx1ZXM6ICVzLCAlcycsIG51bGwsIHVuZGVmaW5lZCk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1ZhbHVlczogbnVsbCwgdW5kZWZpbmVkXFxuJyk7XG5cbiAgICAgIC8vIE9iamVjdCBzdHlsZVxuICAgICAgaW5mbyh7IG1lc3NhZ2U6ICdWYWx1ZXM6ICVzLCAlcycgfSwgbnVsbCwgdW5kZWZpbmVkKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVmFsdWVzOiBudWxsLCB1bmRlZmluZWRcXG4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2hhbmRsZXMgY2lyY3VsYXIgcmVmZXJlbmNlcyBpbiBvYmplY3RzIHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBvYmo6IGFueSA9IHsgbmFtZTogJ3Rlc3QnIH07XG4gICAgICBvYmouc2VsZiA9IG9iajtcblxuICAgICAgLy8gU3RyaW5nIHN0eWxlXG4gICAgICBpbmZvKCdPYmplY3Q6ICVqJywgb2JqKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Quc3RyaW5nQ29udGFpbmluZygnW0NpcmN1bGFyJykpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGluZm8oeyBtZXNzYWdlOiAnT2JqZWN0OiAlaicgfSwgb2JqKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Quc3RyaW5nQ29udGFpbmluZygnW0NpcmN1bGFyJykpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWVzc2FnZSBjb2RlcycsICgpID0+IHtcbiAgICB0ZXN0KCd2YWxpZGF0ZXMgbWVzc2FnZSBjb2RlcyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICAvLyBWYWxpZCBjb2Rlc1xuICAgICAgZXhwZWN0KCgpID0+IGVycm9yKHsgbWVzc2FnZTogJ3Rlc3QnLCBjb2RlOiAnQ0RLX1RPT0xLSVRfRTAwMDEnIH0pKS5ub3QudG9UaHJvdygpO1xuICAgICAgZXhwZWN0KCgpID0+IHdhcm5pbmcoeyBtZXNzYWdlOiAndGVzdCcsIGNvZGU6ICdDREtfQVNTRVRTX1c0OTk5JyB9KSkubm90LnRvVGhyb3coKTtcbiAgICAgIGV4cGVjdCgoKSA9PiBpbmZvKHsgbWVzc2FnZTogJ3Rlc3QnLCBjb2RlOiAnQ0RLX1NES19JMDAwMCcgfSkpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd1c2VzIGRlZmF1bHQgY29kZXMgd2hlbiBub25lIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgICAgZXJyb3IoJ3Rlc3QgZXJyb3InKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Quc3RyaW5nQ29udGFpbmluZygndGVzdCBlcnJvcicpKTtcbiAgICAgIC8vIFdvdWxkIG5lZWQgdG8gbW9kaWZ5IHRoZSBjb2RlIHRvIGV4cG9zZSB0aGUgYWN0dWFsIG1lc3NhZ2UgY29kZSBmb3IgdmVyaWZpY2F0aW9uXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDSSBtb2RlIGJlaGF2aW9yJywgKCkgPT4ge1xuICAgIHRlc3QoJ2NvcnJlY3RseSBzd2l0Y2hlcyBiZXR3ZWVuIHN0ZG91dCBhbmQgc3RkZXJyIGJhc2VkIG9uIENJIG1vZGUnLCAoKSA9PiB7XG4gICAgICBpb0hvc3QuaXNDSSA9IHRydWU7XG4gICAgICB3YXJuaW5nKCd3YXJuaW5nIGluIENJJyk7XG4gICAgICBzdWNjZXNzKCdzdWNjZXNzIGluIENJJyk7XG4gICAgICBlcnJvcignZXJyb3IgaW4gQ0knKTtcblxuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd3YXJuaW5nIGluIENJXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZG91dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N1Y2Nlc3MgaW4gQ0lcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXJyb3IgaW4gQ0lcXG4nKTtcblxuICAgICAgaW9Ib3N0LmlzQ0kgPSBmYWxzZTtcbiAgICAgIHdhcm5pbmcoJ3dhcm5pbmcgbm90IGluIENJJyk7XG4gICAgICBzdWNjZXNzKCdzdWNjZXNzIG5vdCBpbiBDSScpO1xuICAgICAgZXJyb3IoJ2Vycm9yIG5vdCBpbiBDSScpO1xuXG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3dhcm5pbmcgbm90IGluIENJXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N1Y2Nlc3Mgbm90IGluIENJXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2Vycm9yIG5vdCBpbiBDSVxcbicpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19