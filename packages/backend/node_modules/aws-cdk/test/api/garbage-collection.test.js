"use strict";
/* eslint-disable import/order */
Object.defineProperty(exports, "__esModule", { value: true });
const client_cloudformation_1 = require("@aws-sdk/client-cloudformation");
const api_1 = require("../../lib/api");
const mock_sdk_1 = require("../util/mock-sdk");
const client_s3_1 = require("@aws-sdk/client-s3");
const stack_refresh_1 = require("../../lib/api/garbage-collection/stack-refresh");
const progress_printer_1 = require("../../lib/api/garbage-collection/progress-printer");
const client_ecr_1 = require("@aws-sdk/client-ecr");
let garbageCollector;
let stderrMock;
const cfnClient = mock_sdk_1.mockCloudFormationClient;
const s3Client = mock_sdk_1.mockS3Client;
const ecrClient = mock_sdk_1.mockECRClient;
const DAY = 24 * 60 * 60 * 1000; // Number of milliseconds in a day
beforeEach(() => {
    // By default, we'll return a non-found toolkit info
    jest.spyOn(api_1.ToolkitInfo, 'lookup').mockResolvedValue(api_1.ToolkitInfo.bootstrapStackNotFoundInfo('GarbageStack'));
    // Suppress stderr to not spam output during tests
    stderrMock = jest.spyOn(process.stderr, 'write').mockImplementation(() => {
        return true;
    });
    prepareDefaultCfnMock();
    prepareDefaultS3Mock();
    prepareDefaultEcrMock();
});
afterEach(() => {
    stderrMock.mockReset();
});
function mockTheToolkitInfo(stackProps) {
    jest.spyOn(api_1.ToolkitInfo, 'lookup').mockResolvedValue(api_1.ToolkitInfo.fromStack((0, mock_sdk_1.mockBootstrapStack)(stackProps)));
}
function gc(props) {
    return new api_1.GarbageCollector({
        sdkProvider: new mock_sdk_1.MockSdkProvider(),
        action: props.action,
        resolvedEnvironment: {
            account: '123456789012',
            region: 'us-east-1',
            name: 'mock',
        },
        bootstrapStackName: 'GarbageStack',
        rollbackBufferDays: props.rollbackBufferDays ?? 0,
        createdBufferDays: props.createdAtBufferDays ?? 0,
        type: props.type,
        confirm: false,
    });
}
describe('S3 Garbage Collection', () => {
    test('rollbackBufferDays = 0 -- assets to be deleted', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // no tagging
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, 0);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.PutObjectTaggingCommand, 0);
        // assets are to be deleted
        expect(s3Client).toHaveReceivedCommandWith(client_s3_1.DeleteObjectsCommand, {
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    { Key: 'asset1' },
                    { Key: 'asset2' },
                    { Key: 'asset3' },
                ],
                Quiet: true,
            },
        });
    });
    test('rollbackBufferDays > 0 -- assets to be tagged', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // assets tagged
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, 3);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.PutObjectTaggingCommand, 2);
        // no deleting
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.DeleteObjectsCommand, 0);
    });
    test('createdAtBufferDays > 0', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            createdAtBufferDays: 5,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(s3Client).toHaveReceivedCommandWith(client_s3_1.DeleteObjectsCommand, {
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    // asset1 not deleted because it is too young
                    { Key: 'asset2' },
                    { Key: 'asset3' },
                ],
                Quiet: true,
            },
        });
    });
    test('action = print -- does not tag or delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'print',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // get tags, but dont put tags
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, 3);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.PutObjectTaggingCommand, 0);
        // no deleting
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.DeleteObjectsCommand, 0);
    });
    test('action = tag -- does not delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // tags objects
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, 3);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.PutObjectTaggingCommand, 2); // one object already has the tag
        // no deleting
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.DeleteObjectsCommand, 0);
    });
    test('action = delete-tagged -- does not tag', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'delete-tagged',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // get tags, but dont put tags
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, 3);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.PutObjectTaggingCommand, 0);
    });
    test('ignore objects that are modified after gc start', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        s3Client.on(client_s3_1.ListObjectsV2Command).resolves({
            Contents: [
                { Key: 'asset1', LastModified: new Date(0) },
                { Key: 'asset2', LastModified: new Date(0) },
                { Key: 'asset3', LastModified: new Date(new Date().setFullYear(new Date().getFullYear() + 1)) }, // future date ignored everywhere
            ],
            KeyCount: 3,
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        // assets are to be deleted
        expect(s3Client).toHaveReceivedCommandWith(client_s3_1.DeleteObjectsCommand, {
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    { Key: 'asset1' },
                    { Key: 'asset2' },
                    // no asset3
                ],
                Quiet: true,
            },
        });
    });
});
describe('ECR Garbage Collection', () => {
    test('rollbackBufferDays = 0 -- assets to be deleted', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.DescribeImagesCommand, 1);
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.ListImagesCommand, 2);
        // no tagging
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.PutImageCommand, 0);
        // assets are to be deleted
        expect(ecrClient).toHaveReceivedCommandWith(client_ecr_1.BatchDeleteImageCommand, {
            repositoryName: 'REPO_NAME',
            imageIds: [
                { imageDigest: 'digest3' },
                { imageDigest: 'digest2' },
            ],
        });
    });
    test('rollbackBufferDays > 0 -- assets to be tagged', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        // assets tagged
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.PutImageCommand, 2);
        // no deleting
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.BatchDeleteImageCommand, 0);
    });
    test('createdAtBufferDays > 0', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            createdAtBufferDays: 5,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(ecrClient).toHaveReceivedCommandWith(client_ecr_1.BatchDeleteImageCommand, {
            repositoryName: 'REPO_NAME',
            imageIds: [
                // digest3 is too young to be deleted
                { imageDigest: 'digest2' },
            ],
        });
    });
    test('action = print -- does not tag or delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'print',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        // dont put tags
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.PutImageCommand, 0);
        // no deleting
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.BatchDeleteImageCommand, 0);
    });
    test('action = tag -- does not delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        // tags objects
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.PutImageCommand, 2);
        // no deleting
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.BatchDeleteImageCommand, 0);
    });
    test('action = delete-tagged -- does not tag', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'delete-tagged',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        // dont put tags
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.PutImageCommand, 0);
    });
    test('ignore images that are modified after gc start', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        prepareDefaultEcrMock();
        ecrClient.on(client_ecr_1.DescribeImagesCommand).resolves({
            imageDetails: [
                {
                    imageDigest: 'digest3',
                    imageTags: ['klmno'],
                    imagePushedAt: daysInThePast(2),
                    imageSizeInBytes: 100,
                },
                {
                    imageDigest: 'digest2',
                    imageTags: ['fghij'],
                    imagePushedAt: yearsInTheFuture(1),
                    imageSizeInBytes: 300000000,
                },
                {
                    imageDigest: 'digest1',
                    imageTags: ['abcde'],
                    imagePushedAt: daysInThePast(100),
                    imageSizeInBytes: 1000000000,
                },
            ],
        });
        prepareDefaultCfnMock();
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        // assets are to be deleted
        expect(ecrClient).toHaveReceivedCommandWith(client_ecr_1.BatchDeleteImageCommand, {
            repositoryName: 'REPO_NAME',
            imageIds: [
                { imageDigest: 'digest3' },
            ],
        });
    });
    test('succeeds when no images are present', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        prepareDefaultEcrMock();
        ecrClient.on(client_ecr_1.ListImagesCommand).resolves({
            imageIds: [],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            action: 'full',
        });
        // succeeds without hanging
        await garbageCollector.garbageCollect();
    });
    test('tags are unique', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        // tags objects
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.PutImageCommand, 2);
        expect(ecrClient).toHaveReceivedCommandWith(client_ecr_1.PutImageCommand, {
            repositoryName: 'REPO_NAME',
            imageDigest: 'digest3',
            imageManifest: expect.any(String),
            imageTag: expect.stringContaining(`0-${api_1.ECR_ISOLATED_TAG}`),
        });
        expect(ecrClient).toHaveReceivedCommandWith(client_ecr_1.PutImageCommand, {
            repositoryName: 'REPO_NAME',
            imageDigest: 'digest2',
            imageManifest: expect.any(String),
            imageTag: expect.stringContaining(`1-${api_1.ECR_ISOLATED_TAG}`),
        });
    });
    test('listImagesCommand returns nextToken', async () => {
        // This test is to ensure that the garbage collector can handle paginated responses from the ECR API
        // If not handled correctly, the garbage collector will continue to make requests to the ECR API
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        prepareDefaultEcrMock();
        ecrClient.on(client_ecr_1.ListImagesCommand).resolves({
            imageIds: [
                {
                    imageDigest: 'digest1',
                    imageTag: 'abcde',
                },
                {
                    imageDigest: 'digest2',
                    imageTag: 'fghij',
                },
            ],
            nextToken: 'nextToken',
        }).on(client_ecr_1.ListImagesCommand, {
            repositoryName: 'REPO_NAME',
            nextToken: 'nextToken',
        }).resolves({
            imageIds: [
                {
                    imageDigest: 'digest3',
                    imageTag: 'klmno',
                },
            ],
        });
        ecrClient.on(client_ecr_1.BatchGetImageCommand).resolvesOnce({
            images: [
                { imageId: { imageDigest: 'digest1' } },
                { imageId: { imageDigest: 'digest2' } },
            ],
        }).resolvesOnce({
            images: [
                { imageId: { imageDigest: 'digest3' } },
            ],
        });
        ecrClient.on(client_ecr_1.DescribeImagesCommand).resolvesOnce({
            imageDetails: [
                {
                    imageDigest: 'digest1',
                    imageTags: ['abcde'],
                    imagePushedAt: daysInThePast(100),
                    imageSizeInBytes: 1000000000,
                },
                { imageDigest: 'digest2', imageTags: ['fghij'], imagePushedAt: daysInThePast(10), imageSizeInBytes: 300000000 },
            ],
        }).resolvesOnce({
            imageDetails: [
                { imageDigest: 'digest3', imageTags: ['klmno'], imagePushedAt: daysInThePast(2), imageSizeInBytes: 100 },
            ],
        });
        prepareDefaultCfnMock();
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.DescribeImagesCommand, 2);
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.ListImagesCommand, 4);
        // no tagging
        expect(ecrClient).toHaveReceivedCommandTimes(client_ecr_1.PutImageCommand, 0);
        expect(ecrClient).toHaveReceivedCommandWith(client_ecr_1.BatchDeleteImageCommand, {
            repositoryName: 'REPO_NAME',
            imageIds: [
                { imageDigest: 'digest2' },
                { imageDigest: 'digest3' },
            ],
        });
    });
});
describe('CloudFormation API calls', () => {
    test('bootstrap filters out other bootstrap versions', async () => {
        mockTheToolkitInfo({
            Parameters: [{
                    ParameterKey: 'Qualifier',
                    ParameterValue: 'zzzzzz',
                }],
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.GetTemplateSummaryCommand, 2);
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.GetTemplateCommand, 0);
    });
    test('parameter hashes are included', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        cfnClient.on(client_cloudformation_1.GetTemplateSummaryCommand).resolves({
            Parameters: [{
                    ParameterKey: 'AssetParametersasset1',
                    DefaultValue: 'asset1',
                }],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // no tagging
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, 0);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.PutObjectTaggingCommand, 0);
        // assets are to be deleted
        expect(s3Client).toHaveReceivedCommandWith(client_s3_1.DeleteObjectsCommand, {
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    // no 'asset1'
                    { Key: 'asset2' },
                    { Key: 'asset3' },
                ],
                Quiet: true,
            },
        });
    });
});
function prepareDefaultCfnMock() {
    const client = cfnClient;
    client.reset();
    client.on(client_cloudformation_1.ListStacksCommand).resolves({
        StackSummaries: [
            { StackName: 'Stack1', StackStatus: 'CREATE_COMPLETE', CreationTime: new Date() },
            { StackName: 'Stack2', StackStatus: 'UPDATE_COMPLETE', CreationTime: new Date() },
        ],
    });
    client.on(client_cloudformation_1.GetTemplateSummaryCommand).resolves({
        Parameters: [{
                ParameterKey: 'BootstrapVersion',
                DefaultValue: '/cdk-bootstrap/abcde/version',
            }],
    });
    client.on(client_cloudformation_1.GetTemplateCommand).resolves({
        TemplateBody: 'abcde',
    });
    return client;
}
function prepareDefaultS3Mock() {
    const client = s3Client;
    client.reset();
    client.on(client_s3_1.ListObjectsV2Command).resolves({
        Contents: [
            { Key: 'asset1', LastModified: new Date(Date.now() - (2 * DAY)) },
            { Key: 'asset2', LastModified: new Date(Date.now() - (10 * DAY)) },
            { Key: 'asset3', LastModified: new Date(Date.now() - (100 * DAY)) },
        ],
        KeyCount: 3,
    });
    client.on(client_s3_1.GetObjectTaggingCommand).callsFake((params) => ({
        TagSet: params.Key === 'asset2' ? [{ Key: api_1.S3_ISOLATED_TAG, Value: new Date().toISOString() }] : [],
    }));
    return client;
}
function prepareDefaultEcrMock() {
    const client = ecrClient;
    client.reset();
    client.on(client_ecr_1.BatchGetImageCommand).resolves({
        images: [
            { imageId: { imageDigest: 'digest1' } },
            { imageId: { imageDigest: 'digest2' } },
            { imageId: { imageDigest: 'digest3' } },
        ],
    });
    client.on(client_ecr_1.DescribeImagesCommand).resolves({
        imageDetails: [
            { imageDigest: 'digest3', imageTags: ['klmno'], imagePushedAt: daysInThePast(2), imageSizeInBytes: 100 },
            { imageDigest: 'digest2', imageTags: ['fghij'], imagePushedAt: daysInThePast(10), imageSizeInBytes: 300000000 },
            {
                imageDigest: 'digest1',
                imageTags: ['abcde'],
                imagePushedAt: daysInThePast(100),
                imageSizeInBytes: 1000000000,
            },
        ],
    });
    client.on(client_ecr_1.ListImagesCommand).resolves({
        imageIds: [
            { imageDigest: 'digest1', imageTag: 'abcde' }, // inuse
            { imageDigest: 'digest2', imageTag: 'fghij' },
            { imageDigest: 'digest3', imageTag: 'klmno' },
        ],
    });
    return client;
}
describe('Garbage Collection with large # of objects', () => {
    const keyCount = 10000;
    test('tag only', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        mockClientsForLargeObjects();
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 1,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // tagging is performed
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, keyCount);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.DeleteObjectTaggingCommand, 1000); // 1000 in use assets are erroneously tagged
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.PutObjectTaggingCommand, 5000); // 8000-4000 assets need to be tagged, + 1000 (since untag also calls this)
    });
    test('delete-tagged only', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        mockClientsForLargeObjects();
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 1,
            action: 'delete-tagged',
        });
        await garbageCollector.garbageCollect();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.ListObjectsV2Command, 2);
        // delete previously tagged objects
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.GetObjectTaggingCommand, keyCount);
        expect(s3Client).toHaveReceivedCommandTimes(client_s3_1.DeleteObjectsCommand, 4); // 4000 isolated assets are already tagged, deleted in batches of 1000
    });
    function mockClientsForLargeObjects() {
        cfnClient.on(client_cloudformation_1.ListStacksCommand).resolves({
            StackSummaries: [
                { StackName: 'Stack1', StackStatus: 'CREATE_COMPLETE', CreationTime: new Date() },
            ],
        });
        cfnClient.on(client_cloudformation_1.GetTemplateSummaryCommand).resolves({
            Parameters: [{
                    ParameterKey: 'BootstrapVersion',
                    DefaultValue: '/cdk-bootstrap/abcde/version',
                }],
        });
        // add every 5th asset hash to the mock template body: 8000 assets are isolated
        const mockTemplateBody = [];
        for (let i = 0; i < keyCount; i += 5) {
            mockTemplateBody.push(`asset${i}hash`);
        }
        cfnClient.on(client_cloudformation_1.GetTemplateCommand).resolves({
            TemplateBody: mockTemplateBody.join('-'),
        });
        const contents = [];
        for (let i = 0; i < keyCount; i++) {
            contents.push({
                Key: `asset${i}hash`,
                LastModified: new Date(0),
            });
        }
        s3Client.on(client_s3_1.ListObjectsV2Command).resolves({
            Contents: contents,
            KeyCount: keyCount,
        });
        // every other object has the isolated tag: of the 8000 isolated assets, 4000 already are tagged.
        // of the 2000 in use assets, 1000 are tagged.
        s3Client.on(client_s3_1.GetObjectTaggingCommand).callsFake((params) => ({
            TagSet: Number(params.Key[params.Key.length - 5]) % 2 === 0
                ? [{ Key: api_1.S3_ISOLATED_TAG, Value: new Date(2000, 1, 1).toISOString() }]
                : [],
        }));
    }
});
describe('BackgroundStackRefresh', () => {
    let backgroundRefresh;
    let refreshProps;
    let setTimeoutSpy;
    beforeEach(() => {
        jest.useFakeTimers();
        setTimeoutSpy = jest.spyOn(global, 'setTimeout');
        const foo = new mock_sdk_1.MockSdk();
        refreshProps = {
            cfn: foo.cloudFormation(),
            activeAssets: new stack_refresh_1.ActiveAssetCache(),
        };
        backgroundRefresh = new stack_refresh_1.BackgroundStackRefresh(refreshProps);
    });
    afterEach(() => {
        jest.clearAllTimers();
        setTimeoutSpy.mockRestore();
    });
    test('should start after a delay', () => {
        void backgroundRefresh.start();
        expect(setTimeoutSpy).toHaveBeenCalledTimes(1);
        expect(setTimeoutSpy).toHaveBeenLastCalledWith(expect.any(Function), 300000);
    });
    test('should refresh stacks and schedule next refresh', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which should trigger the first refresh)
        await jest.runOnlyPendingTimersAsync();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 1);
        expect(setTimeoutSpy).toHaveBeenCalledTimes(2); // Once for start, once for next refresh
        expect(setTimeoutSpy).toHaveBeenLastCalledWith(expect.any(Function), 300000);
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        expect(cfnClient).toHaveReceivedCommandTimes(client_cloudformation_1.ListStacksCommand, 2);
        expect(setTimeoutSpy).toHaveBeenCalledTimes(3); // Two refreshes plus one more scheduled
    });
    test('should wait for the next refresh if called within time frame', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        const waitPromise = backgroundRefresh.noOlderThan(180000); // 3 minutes
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes
        await expect(waitPromise).resolves.toBeUndefined();
    });
    test('should wait for the next refresh if refresh lands before the timeout', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        jest.advanceTimersByTime(24000); // Advance time by 4 minutes
        const waitPromise = backgroundRefresh.noOlderThan(300000); // 5 minutes
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes, refresh should fire
        await expect(waitPromise).resolves.toBeUndefined();
    });
    test('should reject if the refresh takes too long', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes
        const waitPromise = backgroundRefresh.noOlderThan(0); // 0 seconds
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes
        await expect(waitPromise).rejects.toThrow('refreshStacks took too long; the background thread likely threw an error');
    });
});
describe('ProgressPrinter', () => {
    let progressPrinter;
    let setInterval;
    let clearInterval;
    beforeEach(() => {
        jest.useFakeTimers();
        setInterval = jest.spyOn(global, 'setInterval');
        clearInterval = jest.spyOn(global, 'clearInterval');
        progressPrinter = new progress_printer_1.ProgressPrinter(0, 1000);
    });
    afterEach(() => {
        jest.clearAllTimers();
        setInterval.mockRestore();
        clearInterval.mockRestore();
    });
    test('throws if start is called twice without stop', () => {
        progressPrinter.start();
        expect(setInterval).toHaveBeenCalledTimes(1);
        expect(() => progressPrinter.start()).toThrow('ProgressPrinter is already running. Stop it first using the stop() method before starting it again.');
    });
});
function daysInThePast(days) {
    const d = new Date();
    d.setDate(d.getDate() - days);
    return d;
}
function yearsInTheFuture(years) {
    const d = new Date();
    d.setFullYear(d.getFullYear() + years);
    return d;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FyYmFnZS1jb2xsZWN0aW9uLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnYXJiYWdlLWNvbGxlY3Rpb24udGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaUNBQWlDOztBQUVqQywwRUFLd0M7QUFDeEMsdUNBQWlHO0FBQ2pHLCtDQUF1STtBQUN2SSxrREFNNEI7QUFDNUIsa0ZBSXdEO0FBQ3hELHdGQUFvRjtBQUNwRixvREFNNkI7QUFFN0IsSUFBSSxnQkFBa0MsQ0FBQztBQUV2QyxJQUFJLFVBQTRCLENBQUM7QUFDakMsTUFBTSxTQUFTLEdBQUcsbUNBQXdCLENBQUM7QUFDM0MsTUFBTSxRQUFRLEdBQUcsdUJBQVksQ0FBQztBQUM5QixNQUFNLFNBQVMsR0FBRyx3QkFBYSxDQUFDO0FBRWhDLE1BQU0sR0FBRyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLGtDQUFrQztBQUVuRSxVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2Qsb0RBQW9EO0lBQ3BELElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBVyxDQUFDLDBCQUEwQixDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7SUFFNUcsa0RBQWtEO0lBQ2xELFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFO1FBQ3ZFLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDLENBQUM7SUFFSCxxQkFBcUIsRUFBRSxDQUFDO0lBQ3hCLG9CQUFvQixFQUFFLENBQUM7SUFDdkIscUJBQXFCLEVBQUUsQ0FBQztBQUMxQixDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7SUFDYixVQUFVLENBQUMsU0FBUyxFQUFFLENBQUM7QUFDekIsQ0FBQyxDQUFD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O1FBQzdDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMscUdBQXFHLENBQUMsQ0FBQztJQUN2SixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxhQUFhLENBQUMsSUFBWTtJQUNqQyxNQUFNLENBQUMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQzlCLE9BQU8sQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQUVELFNBQVMsZ0JBQWdCLENBQUMsS0FBYTtJQUNyQyxNQUFNLENBQUMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDO0lBQ3ZDLE9BQU8sQ0FBQyxDQUFDO0FBQ1gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9vcmRlciAqL1xuXG5pbXBvcnQge1xuICBHZXRUZW1wbGF0ZUNvbW1hbmQsXG4gIEdldFRlbXBsYXRlU3VtbWFyeUNvbW1hbmQsXG4gIExpc3RTdGFja3NDb21tYW5kLFxuICBTdGFjayxcbn0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWNsb3VkZm9ybWF0aW9uJztcbmltcG9ydCB7IEVDUl9JU09MQVRFRF9UQUcsIEdhcmJhZ2VDb2xsZWN0b3IsIFMzX0lTT0xBVEVEX1RBRywgVG9vbGtpdEluZm8gfSBmcm9tICcuLi8uLi9saWIvYXBpJztcbmltcG9ydCB7IG1vY2tCb290c3RyYXBTdGFjaywgbW9ja0Nsb3VkRm9ybWF0aW9uQ2xpZW50LCBtb2NrRUNSQ2xpZW50LCBtb2NrUzNDbGllbnQsIE1vY2tTZGssIE1vY2tTZGtQcm92aWRlciB9IGZyb20gJy4uL3V0aWwvbW9jay1zZGsnO1xuaW1wb3J0IHtcbiAgRGVsZXRlT2JqZWN0c0NvbW1hbmQsXG4gIERlbGV0ZU9iamVjdFRhZ2dpbmdDb21tYW5kLFxuICBHZXRPYmplY3RUYWdnaW5nQ29tbWFuZCxcbiAgTGlzdE9iamVjdHNWMkNvbW1hbmQsXG4gIFB1dE9iamVjdFRhZ2dpbmdDb21tYW5kLFxufSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xuaW1wb3J0IHtcbiAgQWN0aXZlQXNzZXRDYWNoZSxcbiAgQmFja2dyb3VuZFN0YWNrUmVmcmVzaCxcbiAgQmFja2dyb3VuZFN0YWNrUmVmcmVzaFByb3BzLFxufSBmcm9tICcuLi8uLi9saWIvYXBpL2dhcmJhZ2UtY29sbGVjdGlvbi9zdGFjay1yZWZyZXNoJztcbmltcG9ydCB7IFByb2dyZXNzUHJpbnRlciB9IGZyb20gJy4uLy4uL2xpYi9hcGkvZ2FyYmFnZS1jb2xsZWN0aW9uL3Byb2dyZXNzLXByaW50ZXInO1xuaW1wb3J0IHtcbiAgQmF0Y2hEZWxldGVJbWFnZUNvbW1hbmQsXG4gIEJhdGNoR2V0SW1hZ2VDb21tYW5kLFxuICBEZXNjcmliZUltYWdlc0NvbW1hbmQsXG4gIExpc3RJbWFnZXNDb21tYW5kLFxuICBQdXRJbWFnZUNvbW1hbmQsXG59IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1lY3InO1xuXG5sZXQgZ2FyYmFnZUNvbGxlY3RvcjogR2FyYmFnZUNvbGxlY3RvcjtcblxubGV0IHN0ZGVyck1vY2s6IGplc3QuU3B5SW5zdGFuY2U7XG5jb25zdCBjZm5DbGllbnQgPSBtb2NrQ2xvdWRGb3JtYXRpb25DbGllbnQ7XG5jb25zdCBzM0NsaWVudCA9IG1vY2tTM0NsaWVudDtcbmNvbnN0IGVjckNsaWVudCA9IG1vY2tFQ1JDbGllbnQ7XG5cbmNvbnN0IERBWSA9IDI0ICogNjAgKiA2MCAqIDEwMDA7IC8vIE51bWJlciBvZiBtaWxsaXNlY29uZHMgaW4gYSBkYXlcblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIC8vIEJ5IGRlZmF1bHQsIHdlJ2xsIHJldHVybiBhIG5vbi1mb3VuZCB0b29sa2l0IGluZm9cbiAgamVzdC5zcHlPbihUb29sa2l0SW5mbywgJ2xvb2t1cCcpLm1vY2tSZXNvbHZlZFZhbHVlKFRvb2xraXRJbmZvLmJvb3RzdHJhcFN0YWNrTm90Rm91bmRJbmZvKCdHYXJiYWdlU3RhY2snKSk7XG5cbiAgLy8gU3VwcHJlc3Mgc3RkZXJyIHRvIG5vdCBzcGFtIG91dHB1dCBkdXJpbmcgdGVzdHNcbiAgc3RkZXJyTW9jayA9IGplc3Quc3B5T24ocHJvY2Vzcy5zdGRlcnIsICd3cml0ZScpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0pO1xuXG4gIHByZXBhcmVEZWZhdWx0Q2ZuTW9jaygpO1xuICBwcmVwYXJlRGVmYXVsdFMzTW9jaygpO1xuICBwcmVwYXJlRGVmYXVsdEVjck1vY2soKTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICBzdGRlcnJNb2NrLm1vY2tSZXNldCgpO1xufSk7XG5cbmZ1bmN0aW9uIG1vY2tUaGVUb29sa2l0SW5mbyhzdGFja1Byb3BzOiBQYXJ0aWFsPFN0YWNrPikge1xuICBqZXN0LnNweU9uKFRvb2xraXRJbmZvLCAnbG9va3VwJykubW9ja1Jlc29sdmVkVmFsdWUoVG9vbGtpdEluZm8uZnJvbVN0YWNrKG1vY2tCb290c3RyYXBTdGFjayhzdGFja1Byb3BzKSkpO1xufVxuXG5mdW5jdGlvbiBnYyhwcm9wczoge1xuICB0eXBlOiAnczMnIHwgJ2VjcicgfCAnYWxsJztcbiAgcm9sbGJhY2tCdWZmZXJEYXlzPzogbnVtYmVyO1xuICBjcmVhdGVkQXRCdWZmZXJEYXlzPzogbnVtYmVyO1xuICBhY3Rpb246ICdmdWxsJyB8ICdwcmludCcgfCAndGFnJyB8ICdkZWxldGUtdGFnZ2VkJztcbn0pOiBHYXJiYWdlQ29sbGVjdG9yIHtcbiAgcmV0dXJuIG5ldyBHYXJiYWdlQ29sbGVjdG9yKHtcbiAgICBzZGtQcm92aWRlcjogbmV3IE1vY2tTZGtQcm92aWRlcigpLFxuICAgIGFjdGlvbjogcHJvcHMuYWN0aW9uLFxuICAgIHJlc29sdmVkRW52aXJvbm1lbnQ6IHtcbiAgICAgIGFjY291bnQ6ICcxMjM0NTY3ODkwMTInLFxuICAgICAgcmVnaW9uOiAndXMtZWFzdC0xJyxcbiAgICAgIG5hbWU6ICdtb2NrJyxcbiAgICB9LFxuICAgIGJvb3RzdHJhcFN0YWNrTmFtZTogJ0dhcmJhZ2VTdGFjaycsXG4gICAgcm9sbGJhY2tCdWZmZXJEYXlzOiBwcm9wcy5yb2xsYmFja0J1ZmZlckRheXMgPz8gMCxcbiAgICBjcmVhdGVkQnVmZmVyRGF5czogcHJvcHMuY3JlYXRlZEF0QnVmZmVyRGF5cyA/PyAwLFxuICAgIHR5cGU6IHByb3BzLnR5cGUsXG4gICAgY29uZmlybTogZmFsc2UsXG4gIH0pO1xufVxuXG5kZXNjcmliZSgnUzMgR2FyYmFnZSBDb2xsZWN0aW9uJywgKCkgPT4ge1xuICB0ZXN0KCdyb2xsYmFja0J1ZmZlckRheXMgPSAwIC0tIGFzc2V0cyB0byBiZSBkZWxldGVkJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDAsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0U3RhY2tzQ29tbWFuZCwgMSk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0T2JqZWN0c1YyQ29tbWFuZCwgMik7XG5cbiAgICAvLyBubyB0YWdnaW5nXG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhHZXRPYmplY3RUYWdnaW5nQ29tbWFuZCwgMCk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhQdXRPYmplY3RUYWdnaW5nQ29tbWFuZCwgMCk7XG5cbiAgICAvLyBhc3NldHMgYXJlIHRvIGJlIGRlbGV0ZWRcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFdpdGgoRGVsZXRlT2JqZWN0c0NvbW1hbmQsIHtcbiAgICAgIEJ1Y2tldDogJ0JVQ0tFVF9OQU1FJyxcbiAgICAgIERlbGV0ZToge1xuICAgICAgICBPYmplY3RzOiBbXG4gICAgICAgICAgeyBLZXk6ICdhc3NldDEnIH0sXG4gICAgICAgICAgeyBLZXk6ICdhc3NldDInIH0sXG4gICAgICAgICAgeyBLZXk6ICdhc3NldDMnIH0sXG4gICAgICAgIF0sXG4gICAgICAgIFF1aWV0OiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgncm9sbGJhY2tCdWZmZXJEYXlzID4gMCAtLSBhc3NldHMgdG8gYmUgdGFnZ2VkJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0U3RhY2tzQ29tbWFuZCwgMSk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0T2JqZWN0c1YyQ29tbWFuZCwgMik7XG5cbiAgICAvLyBhc3NldHMgdGFnZ2VkXG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhHZXRPYmplY3RUYWdnaW5nQ29tbWFuZCwgMyk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhQdXRPYmplY3RUYWdnaW5nQ29tbWFuZCwgMik7XG5cbiAgICAvLyBubyBkZWxldGluZ1xuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoRGVsZXRlT2JqZWN0c0NvbW1hbmQsIDApO1xuICB9KTtcblxuICB0ZXN0KCdjcmVhdGVkQXRCdWZmZXJEYXlzID4gMCcsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYyh7XG4gICAgICB0eXBlOiAnczMnLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAwLFxuICAgICAgY3JlYXRlZEF0QnVmZmVyRGF5czogNSxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kV2l0aChEZWxldGVPYmplY3RzQ29tbWFuZCwge1xuICAgICAgQnVja2V0OiAnQlVDS0VUX05BTUUnLFxuICAgICAgRGVsZXRlOiB7XG4gICAgICAgIE9iamVjdHM6IFtcbiAgICAgICAgICAvLyBhc3NldDEgbm90IGRlbGV0ZWQgYmVjYXVzZSBpdCBpcyB0b28geW91bmdcbiAgICAgICAgICB7IEtleTogJ2Fzc2V0MicgfSxcbiAgICAgICAgICB7IEtleTogJ2Fzc2V0MycgfSxcbiAgICAgICAgXSxcbiAgICAgICAgUXVpZXQ6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdhY3Rpb24gPSBwcmludCAtLSBkb2VzIG5vdCB0YWcgb3IgZGVsZXRlJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICdwcmludCcsXG4gICAgfSk7XG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuXG4gICAgZXhwZWN0KGNmbkNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoTGlzdFN0YWNrc0NvbW1hbmQsIDEpO1xuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoTGlzdE9iamVjdHNWMkNvbW1hbmQsIDIpO1xuXG4gICAgLy8gZ2V0IHRhZ3MsIGJ1dCBkb250IHB1dCB0YWdzXG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhHZXRPYmplY3RUYWdnaW5nQ29tbWFuZCwgMyk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhQdXRPYmplY3RUYWdnaW5nQ29tbWFuZCwgMCk7XG5cbiAgICAvLyBubyBkZWxldGluZ1xuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoRGVsZXRlT2JqZWN0c0NvbW1hbmQsIDApO1xuICB9KTtcblxuICB0ZXN0KCdhY3Rpb24gPSB0YWcgLS0gZG9lcyBub3QgZGVsZXRlJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICd0YWcnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChjZm5DbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKExpc3RTdGFja3NDb21tYW5kLCAxKTtcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKExpc3RPYmplY3RzVjJDb21tYW5kLCAyKTtcblxuICAgIC8vIHRhZ3Mgb2JqZWN0c1xuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoR2V0T2JqZWN0VGFnZ2luZ0NvbW1hbmQsIDMpO1xuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoUHV0T2JqZWN0VGFnZ2luZ0NvbW1hbmQsIDIpOyAvLyBvbmUgb2JqZWN0IGFscmVhZHkgaGFzIHRoZSB0YWdcblxuICAgIC8vIG5vIGRlbGV0aW5nXG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhEZWxldGVPYmplY3RzQ29tbWFuZCwgMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FjdGlvbiA9IGRlbGV0ZS10YWdnZWQgLS0gZG9lcyBub3QgdGFnJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICdkZWxldGUtdGFnZ2VkJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0U3RhY2tzQ29tbWFuZCwgMSk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0T2JqZWN0c1YyQ29tbWFuZCwgMik7XG5cbiAgICAvLyBnZXQgdGFncywgYnV0IGRvbnQgcHV0IHRhZ3NcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKEdldE9iamVjdFRhZ2dpbmdDb21tYW5kLCAzKTtcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKFB1dE9iamVjdFRhZ2dpbmdDb21tYW5kLCAwKTtcbiAgfSk7XG5cbiAgdGVzdCgnaWdub3JlIG9iamVjdHMgdGhhdCBhcmUgbW9kaWZpZWQgYWZ0ZXIgZ2Mgc3RhcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBzM0NsaWVudC5vbihMaXN0T2JqZWN0c1YyQ29tbWFuZCkucmVzb2x2ZXMoe1xuICAgICAgQ29udGVudHM6IFtcbiAgICAgICAgeyBLZXk6ICdhc3NldDEnLCBMYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKDApIH0sXG4gICAgICAgIHsgS2V5OiAnYXNzZXQyJywgTGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgwKSB9LFxuICAgICAgICB7IEtleTogJ2Fzc2V0MycsIExhc3RNb2RpZmllZDogbmV3IERhdGUobmV3IERhdGUoKS5zZXRGdWxsWWVhcihuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkgKyAxKSkgfSwgLy8gZnV0dXJlIGRhdGUgaWdub3JlZCBldmVyeXdoZXJlXG4gICAgICBdLFxuICAgICAgS2V5Q291bnQ6IDMsXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIC8vIGFzc2V0cyBhcmUgdG8gYmUgZGVsZXRlZFxuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kV2l0aChEZWxldGVPYmplY3RzQ29tbWFuZCwge1xuICAgICAgQnVja2V0OiAnQlVDS0VUX05BTUUnLFxuICAgICAgRGVsZXRlOiB7XG4gICAgICAgIE9iamVjdHM6IFtcbiAgICAgICAgICB7IEtleTogJ2Fzc2V0MScgfSxcbiAgICAgICAgICB7IEtleTogJ2Fzc2V0MicgfSxcbiAgICAgICAgICAvLyBubyBhc3NldDNcbiAgICAgICAgXSxcbiAgICAgICAgUXVpZXQ6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnRUNSIEdhcmJhZ2UgQ29sbGVjdGlvbicsICgpID0+IHtcbiAgdGVzdCgncm9sbGJhY2tCdWZmZXJEYXlzID0gMCAtLSBhc3NldHMgdG8gYmUgZGVsZXRlZCcsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYyh7XG4gICAgICB0eXBlOiAnZWNyJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChlY3JDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKERlc2NyaWJlSW1hZ2VzQ29tbWFuZCwgMSk7XG4gICAgZXhwZWN0KGVjckNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoTGlzdEltYWdlc0NvbW1hbmQsIDIpO1xuXG4gICAgLy8gbm8gdGFnZ2luZ1xuICAgIGV4cGVjdChlY3JDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKFB1dEltYWdlQ29tbWFuZCwgMCk7XG5cbiAgICAvLyBhc3NldHMgYXJlIHRvIGJlIGRlbGV0ZWRcbiAgICBleHBlY3QoZWNyQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRXaXRoKEJhdGNoRGVsZXRlSW1hZ2VDb21tYW5kLCB7XG4gICAgICByZXBvc2l0b3J5TmFtZTogJ1JFUE9fTkFNRScsXG4gICAgICBpbWFnZUlkczogW1xuICAgICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MycgfSxcbiAgICAgICAgeyBpbWFnZURpZ2VzdDogJ2RpZ2VzdDInIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdyb2xsYmFja0J1ZmZlckRheXMgPiAwIC0tIGFzc2V0cyB0byBiZSB0YWdnZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ2VjcicsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICAvLyBhc3NldHMgdGFnZ2VkXG4gICAgZXhwZWN0KGVjckNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoUHV0SW1hZ2VDb21tYW5kLCAyKTtcblxuICAgIC8vIG5vIGRlbGV0aW5nXG4gICAgZXhwZWN0KGVjckNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoQmF0Y2hEZWxldGVJbWFnZUNvbW1hbmQsIDApO1xuICB9KTtcblxuICB0ZXN0KCdjcmVhdGVkQXRCdWZmZXJEYXlzID4gMCcsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYyh7XG4gICAgICB0eXBlOiAnZWNyJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGNyZWF0ZWRBdEJ1ZmZlckRheXM6IDUsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoZWNyQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRXaXRoKEJhdGNoRGVsZXRlSW1hZ2VDb21tYW5kLCB7XG4gICAgICByZXBvc2l0b3J5TmFtZTogJ1JFUE9fTkFNRScsXG4gICAgICBpbWFnZUlkczogW1xuICAgICAgICAvLyBkaWdlc3QzIGlzIHRvbyB5b3VuZyB0byBiZSBkZWxldGVkXG4gICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QyJyB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnYWN0aW9uID0gcHJpbnQgLS0gZG9lcyBub3QgdGFnIG9yIGRlbGV0ZScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYyh7XG4gICAgICB0eXBlOiAnZWNyJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMyxcbiAgICAgIGFjdGlvbjogJ3ByaW50JyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0U3RhY2tzQ29tbWFuZCwgMSk7XG5cbiAgICAvLyBkb250IHB1dCB0YWdzXG4gICAgZXhwZWN0KGVjckNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoUHV0SW1hZ2VDb21tYW5kLCAwKTtcblxuICAgIC8vIG5vIGRlbGV0aW5nXG4gICAgZXhwZWN0KGVjckNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoQmF0Y2hEZWxldGVJbWFnZUNvbW1hbmQsIDApO1xuICB9KTtcblxuICB0ZXN0KCdhY3Rpb24gPSB0YWcgLS0gZG9lcyBub3QgZGVsZXRlJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAzLFxuICAgICAgYWN0aW9uOiAndGFnJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0U3RhY2tzQ29tbWFuZCwgMSk7XG5cbiAgICAvLyB0YWdzIG9iamVjdHNcbiAgICBleHBlY3QoZWNyQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhQdXRJbWFnZUNvbW1hbmQsIDIpO1xuXG4gICAgLy8gbm8gZGVsZXRpbmdcbiAgICBleHBlY3QoZWNyQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhCYXRjaERlbGV0ZUltYWdlQ29tbWFuZCwgMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FjdGlvbiA9IGRlbGV0ZS10YWdnZWQgLS0gZG9lcyBub3QgdGFnJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAzLFxuICAgICAgYWN0aW9uOiAnZGVsZXRlLXRhZ2dlZCcsXG4gICAgfSk7XG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuXG4gICAgZXhwZWN0KGNmbkNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoTGlzdFN0YWNrc0NvbW1hbmQsIDEpO1xuXG4gICAgLy8gZG9udCBwdXQgdGFnc1xuICAgIGV4cGVjdChlY3JDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKFB1dEltYWdlQ29tbWFuZCwgMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2lnbm9yZSBpbWFnZXMgdGhhdCBhcmUgbW9kaWZpZWQgYWZ0ZXIgZ2Mgc3RhcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBwcmVwYXJlRGVmYXVsdEVjck1vY2soKTtcbiAgICBlY3JDbGllbnQub24oRGVzY3JpYmVJbWFnZXNDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgICBpbWFnZURldGFpbHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGltYWdlRGlnZXN0OiAnZGlnZXN0MycsXG4gICAgICAgICAgaW1hZ2VUYWdzOiBbJ2tsbW5vJ10sXG4gICAgICAgICAgaW1hZ2VQdXNoZWRBdDogZGF5c0luVGhlUGFzdCgyKSxcbiAgICAgICAgICBpbWFnZVNpemVJbkJ5dGVzOiAxMDAsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpbWFnZURpZ2VzdDogJ2RpZ2VzdDInLFxuICAgICAgICAgIGltYWdlVGFnczogWydmZ2hpaiddLFxuICAgICAgICAgIGltYWdlUHVzaGVkQXQ6IHllYXJzSW5UaGVGdXR1cmUoMSksXG4gICAgICAgICAgaW1hZ2VTaXplSW5CeXRlczogMzAwXzAwMF8wMDAsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpbWFnZURpZ2VzdDogJ2RpZ2VzdDEnLFxuICAgICAgICAgIGltYWdlVGFnczogWydhYmNkZSddLFxuICAgICAgICAgIGltYWdlUHVzaGVkQXQ6IGRheXNJblRoZVBhc3QoMTAwKSxcbiAgICAgICAgICBpbWFnZVNpemVJbkJ5dGVzOiAxXzAwMF8wMDBfMDAwLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgICBwcmVwYXJlRGVmYXVsdENmbk1vY2soKTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYyh7XG4gICAgICB0eXBlOiAnZWNyJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIC8vIGFzc2V0cyBhcmUgdG8gYmUgZGVsZXRlZFxuICAgIGV4cGVjdChlY3JDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFdpdGgoQmF0Y2hEZWxldGVJbWFnZUNvbW1hbmQsIHtcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiAnUkVQT19OQU1FJyxcbiAgICAgIGltYWdlSWRzOiBbXG4gICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QzJyB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnc3VjY2VlZHMgd2hlbiBubyBpbWFnZXMgYXJlIHByZXNlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBwcmVwYXJlRGVmYXVsdEVjck1vY2soKTtcbiAgICBlY3JDbGllbnQub24oTGlzdEltYWdlc0NvbW1hbmQpLnJlc29sdmVzKHtcbiAgICAgIGltYWdlSWRzOiBbXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYyh7XG4gICAgICB0eXBlOiAnZWNyJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuXG4gICAgLy8gc3VjY2VlZHMgd2l0aG91dCBoYW5naW5nXG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuICB9KTtcblxuICB0ZXN0KCd0YWdzIGFyZSB1bmlxdWUnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ2VjcicsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICd0YWcnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChjZm5DbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKExpc3RTdGFja3NDb21tYW5kLCAxKTtcblxuICAgIC8vIHRhZ3Mgb2JqZWN0c1xuICAgIGV4cGVjdChlY3JDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKFB1dEltYWdlQ29tbWFuZCwgMik7XG4gICAgZXhwZWN0KGVjckNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kV2l0aChQdXRJbWFnZUNvbW1hbmQsIHtcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiAnUkVQT19OQU1FJyxcbiAgICAgIGltYWdlRGlnZXN0OiAnZGlnZXN0MycsXG4gICAgICBpbWFnZU1hbmlmZXN0OiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICBpbWFnZVRhZzogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoYDAtJHtFQ1JfSVNPTEFURURfVEFHfWApLFxuICAgIH0pO1xuICAgIGV4cGVjdChlY3JDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFdpdGgoUHV0SW1hZ2VDb21tYW5kLCB7XG4gICAgICByZXBvc2l0b3J5TmFtZTogJ1JFUE9fTkFNRScsXG4gICAgICBpbWFnZURpZ2VzdDogJ2RpZ2VzdDInLFxuICAgICAgaW1hZ2VNYW5pZmVzdDogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgaW1hZ2VUYWc6IGV4cGVjdC5zdHJpbmdDb250YWluaW5nKGAxLSR7RUNSX0lTT0xBVEVEX1RBR31gKSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnbGlzdEltYWdlc0NvbW1hbmQgcmV0dXJucyBuZXh0VG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gVGhpcyB0ZXN0IGlzIHRvIGVuc3VyZSB0aGF0IHRoZSBnYXJiYWdlIGNvbGxlY3RvciBjYW4gaGFuZGxlIHBhZ2luYXRlZCByZXNwb25zZXMgZnJvbSB0aGUgRUNSIEFQSVxuICAgIC8vIElmIG5vdCBoYW5kbGVkIGNvcnJlY3RseSwgdGhlIGdhcmJhZ2UgY29sbGVjdG9yIHdpbGwgY29udGludWUgdG8gbWFrZSByZXF1ZXN0cyB0byB0aGUgRUNSIEFQSVxuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgcHJlcGFyZURlZmF1bHRFY3JNb2NrKCk7XG4gICAgZWNyQ2xpZW50Lm9uKExpc3RJbWFnZXNDb21tYW5kKS5yZXNvbHZlcyh7IC8vIGRlZmF1bHQgcmVzcG9uc2VcbiAgICAgIGltYWdlSWRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpbWFnZURpZ2VzdDogJ2RpZ2VzdDEnLFxuICAgICAgICAgIGltYWdlVGFnOiAnYWJjZGUnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QyJyxcbiAgICAgICAgICBpbWFnZVRhZzogJ2ZnaGlqJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBuZXh0VG9rZW46ICduZXh0VG9rZW4nLFxuICAgIH0pLm9uKExpc3RJbWFnZXNDb21tYW5kLCB7IC8vIHJlc3BvbnNlIHdoZW4gbmV4dFRva2VuIGlzIHByb3ZpZGVkXG4gICAgICByZXBvc2l0b3J5TmFtZTogJ1JFUE9fTkFNRScsXG4gICAgICBuZXh0VG9rZW46ICduZXh0VG9rZW4nLFxuICAgIH0pLnJlc29sdmVzKHtcbiAgICAgIGltYWdlSWRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpbWFnZURpZ2VzdDogJ2RpZ2VzdDMnLFxuICAgICAgICAgIGltYWdlVGFnOiAna2xtbm8nLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgICBlY3JDbGllbnQub24oQmF0Y2hHZXRJbWFnZUNvbW1hbmQpLnJlc29sdmVzT25jZSh7XG4gICAgICBpbWFnZXM6IFtcbiAgICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MScgfSB9LFxuICAgICAgICB7IGltYWdlSWQ6IHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QyJyB9IH0sXG4gICAgICBdLFxuICAgIH0pLnJlc29sdmVzT25jZSh7XG4gICAgICBpbWFnZXM6IFtcbiAgICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MycgfSB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgICBlY3JDbGllbnQub24oRGVzY3JpYmVJbWFnZXNDb21tYW5kKS5yZXNvbHZlc09uY2Uoe1xuICAgICAgaW1hZ2VEZXRhaWxzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpbWFnZURpZ2VzdDogJ2RpZ2VzdDEnLFxuICAgICAgICAgIGltYWdlVGFnczogWydhYmNkZSddLFxuICAgICAgICAgIGltYWdlUHVzaGVkQXQ6IGRheXNJblRoZVBhc3QoMTAwKSxcbiAgICAgICAgICBpbWFnZVNpemVJbkJ5dGVzOiAxXzAwMF8wMDBfMDAwLFxuICAgICAgICB9LFxuICAgICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MicsIGltYWdlVGFnczogWydmZ2hpaiddLCBpbWFnZVB1c2hlZEF0OiBkYXlzSW5UaGVQYXN0KDEwKSwgaW1hZ2VTaXplSW5CeXRlczogMzAwXzAwMF8wMDAgfSxcbiAgICAgIF0sXG4gICAgfSkucmVzb2x2ZXNPbmNlKHtcbiAgICAgIGltYWdlRGV0YWlsczogW1xuICAgICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MycsIGltYWdlVGFnczogWydrbG1ubyddLCBpbWFnZVB1c2hlZEF0OiBkYXlzSW5UaGVQYXN0KDIpLCBpbWFnZVNpemVJbkJ5dGVzOiAxMDAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gICAgcHJlcGFyZURlZmF1bHRDZm5Nb2NrKCk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ2VjcicsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDAsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoZWNyQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhEZXNjcmliZUltYWdlc0NvbW1hbmQsIDIpO1xuICAgIGV4cGVjdChlY3JDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKExpc3RJbWFnZXNDb21tYW5kLCA0KTtcblxuICAgIC8vIG5vIHRhZ2dpbmdcbiAgICBleHBlY3QoZWNyQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhQdXRJbWFnZUNvbW1hbmQsIDApO1xuXG4gICAgZXhwZWN0KGVjckNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kV2l0aChCYXRjaERlbGV0ZUltYWdlQ29tbWFuZCwge1xuICAgICAgcmVwb3NpdG9yeU5hbWU6ICdSRVBPX05BTUUnLFxuICAgICAgaW1hZ2VJZHM6IFtcbiAgICAgICAgeyBpbWFnZURpZ2VzdDogJ2RpZ2VzdDInIH0sXG4gICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QzJyB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0Nsb3VkRm9ybWF0aW9uIEFQSSBjYWxscycsICgpID0+IHtcbiAgdGVzdCgnYm9vdHN0cmFwIGZpbHRlcnMgb3V0IG90aGVyIGJvb3RzdHJhcCB2ZXJzaW9ucycsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgUGFyYW1ldGVyczogW3tcbiAgICAgICAgUGFyYW1ldGVyS2V5OiAnUXVhbGlmaWVyJyxcbiAgICAgICAgUGFyYW1ldGVyVmFsdWU6ICd6enp6enonLFxuICAgICAgfV0sXG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhHZXRUZW1wbGF0ZVN1bW1hcnlDb21tYW5kLCAyKTtcbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhHZXRUZW1wbGF0ZUNvbW1hbmQsIDApO1xuICB9KTtcblxuICB0ZXN0KCdwYXJhbWV0ZXIgaGFzaGVzIGFyZSBpbmNsdWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNmbkNsaWVudC5vbihHZXRUZW1wbGF0ZVN1bW1hcnlDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgICBQYXJhbWV0ZXJzOiBbe1xuICAgICAgICBQYXJhbWV0ZXJLZXk6ICdBc3NldFBhcmFtZXRlcnNhc3NldDEnLFxuICAgICAgICBEZWZhdWx0VmFsdWU6ICdhc3NldDEnLFxuICAgICAgfV0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChjZm5DbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKExpc3RTdGFja3NDb21tYW5kLCAxKTtcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKExpc3RPYmplY3RzVjJDb21tYW5kLCAyKTtcblxuICAgIC8vIG5vIHRhZ2dpbmdcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKEdldE9iamVjdFRhZ2dpbmdDb21tYW5kLCAwKTtcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKFB1dE9iamVjdFRhZ2dpbmdDb21tYW5kLCAwKTtcblxuICAgIC8vIGFzc2V0cyBhcmUgdG8gYmUgZGVsZXRlZFxuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kV2l0aChEZWxldGVPYmplY3RzQ29tbWFuZCwge1xuICAgICAgQnVja2V0OiAnQlVDS0VUX05BTUUnLFxuICAgICAgRGVsZXRlOiB7XG4gICAgICAgIE9iamVjdHM6IFtcbiAgICAgICAgICAvLyBubyAnYXNzZXQxJ1xuICAgICAgICAgIHsgS2V5OiAnYXNzZXQyJyB9LFxuICAgICAgICAgIHsgS2V5OiAnYXNzZXQzJyB9LFxuICAgICAgICBdLFxuICAgICAgICBRdWlldDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIHByZXBhcmVEZWZhdWx0Q2ZuTW9jaygpIHtcbiAgY29uc3QgY2xpZW50ID0gY2ZuQ2xpZW50O1xuICBjbGllbnQucmVzZXQoKTtcblxuICBjbGllbnQub24oTGlzdFN0YWNrc0NvbW1hbmQpLnJlc29sdmVzKHtcbiAgICBTdGFja1N1bW1hcmllczogW1xuICAgICAgeyBTdGFja05hbWU6ICdTdGFjazEnLCBTdGFja1N0YXR1czogJ0NSRUFURV9DT01QTEVURScsIENyZWF0aW9uVGltZTogbmV3IERhdGUoKSB9LFxuICAgICAgeyBTdGFja05hbWU6ICdTdGFjazInLCBTdGFja1N0YXR1czogJ1VQREFURV9DT01QTEVURScsIENyZWF0aW9uVGltZTogbmV3IERhdGUoKSB9LFxuICAgIF0sXG4gIH0pO1xuXG4gIGNsaWVudC5vbihHZXRUZW1wbGF0ZVN1bW1hcnlDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgUGFyYW1ldGVyczogW3tcbiAgICAgIFBhcmFtZXRlcktleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgRGVmYXVsdFZhbHVlOiAnL2Nkay1ib290c3RyYXAvYWJjZGUvdmVyc2lvbicsXG4gICAgfV0sXG4gIH0pO1xuXG4gIGNsaWVudC5vbihHZXRUZW1wbGF0ZUNvbW1hbmQpLnJlc29sdmVzKHtcbiAgICBUZW1wbGF0ZUJvZHk6ICdhYmNkZScsXG4gIH0pO1xuXG4gIHJldHVybiBjbGllbnQ7XG59XG5cbmZ1bmN0aW9uIHByZXBhcmVEZWZhdWx0UzNNb2NrKCkge1xuICBjb25zdCBjbGllbnQgPSBzM0NsaWVudDtcbiAgY2xpZW50LnJlc2V0KCk7XG5cbiAgY2xpZW50Lm9uKExpc3RPYmplY3RzVjJDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgQ29udGVudHM6IFtcbiAgICAgIHsgS2V5OiAnYXNzZXQxJywgTGFzdE1vZGlmaWVkOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gKDIgKiBEQVkpKSB9LFxuICAgICAgeyBLZXk6ICdhc3NldDInLCBMYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAoMTAgKiBEQVkpKSB9LFxuICAgICAgeyBLZXk6ICdhc3NldDMnLCBMYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAoMTAwICogREFZKSkgfSxcbiAgICBdLFxuICAgIEtleUNvdW50OiAzLFxuICB9KTtcblxuICBjbGllbnQub24oR2V0T2JqZWN0VGFnZ2luZ0NvbW1hbmQpLmNhbGxzRmFrZSgocGFyYW1zKSA9PiAoe1xuICAgIFRhZ1NldDogcGFyYW1zLktleSA9PT0gJ2Fzc2V0MicgPyBbeyBLZXk6IFMzX0lTT0xBVEVEX1RBRywgVmFsdWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9XSA6IFtdLFxuICB9KSk7XG5cbiAgcmV0dXJuIGNsaWVudDtcbn1cblxuZnVuY3Rpb24gcHJlcGFyZURlZmF1bHRFY3JNb2NrKCkge1xuICBjb25zdCBjbGllbnQgPSBlY3JDbGllbnQ7XG4gIGNsaWVudC5yZXNldCgpO1xuXG4gIGNsaWVudC5vbihCYXRjaEdldEltYWdlQ29tbWFuZCkucmVzb2x2ZXMoe1xuICAgIGltYWdlczogW1xuICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MScgfSB9LFxuICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MicgfSB9LFxuICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MycgfSB9LFxuICAgIF0sXG4gIH0pO1xuXG4gIGNsaWVudC5vbihEZXNjcmliZUltYWdlc0NvbW1hbmQpLnJlc29sdmVzKHtcbiAgICBpbWFnZURldGFpbHM6IFtcbiAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QzJywgaW1hZ2VUYWdzOiBbJ2tsbW5vJ10sIGltYWdlUHVzaGVkQXQ6IGRheXNJblRoZVBhc3QoMiksIGltYWdlU2l6ZUluQnl0ZXM6IDEwMCB9LFxuICAgICAgeyBpbWFnZURpZ2VzdDogJ2RpZ2VzdDInLCBpbWFnZVRhZ3M6IFsnZmdoaWonXSwgaW1hZ2VQdXNoZWRBdDogZGF5c0luVGhlUGFzdCgxMCksIGltYWdlU2l6ZUluQnl0ZXM6IDMwMF8wMDBfMDAwIH0sXG4gICAgICB7XG4gICAgICAgIGltYWdlRGlnZXN0OiAnZGlnZXN0MScsXG4gICAgICAgIGltYWdlVGFnczogWydhYmNkZSddLFxuICAgICAgICBpbWFnZVB1c2hlZEF0OiBkYXlzSW5UaGVQYXN0KDEwMCksXG4gICAgICAgIGltYWdlU2l6ZUluQnl0ZXM6IDFfMDAwXzAwMF8wMDAsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xuXG4gIGNsaWVudC5vbihMaXN0SW1hZ2VzQ29tbWFuZCkucmVzb2x2ZXMoe1xuICAgIGltYWdlSWRzOiBbXG4gICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MScsIGltYWdlVGFnOiAnYWJjZGUnIH0sIC8vIGludXNlXG4gICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MicsIGltYWdlVGFnOiAnZmdoaWonIH0sXG4gICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MycsIGltYWdlVGFnOiAna2xtbm8nIH0sXG4gICAgXSxcbiAgfSk7XG5cbiAgcmV0dXJuIGNsaWVudDtcbn1cblxuZGVzY3JpYmUoJ0dhcmJhZ2UgQ29sbGVjdGlvbiB3aXRoIGxhcmdlICMgb2Ygb2JqZWN0cycsICgpID0+IHtcbiAgY29uc3Qga2V5Q291bnQgPSAxMDAwMDtcblxuICB0ZXN0KCd0YWcgb25seScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIG1vY2tDbGllbnRzRm9yTGFyZ2VPYmplY3RzKCk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMSxcbiAgICAgIGFjdGlvbjogJ3RhZycsXG4gICAgfSk7XG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuXG4gICAgZXhwZWN0KGNmbkNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoTGlzdFN0YWNrc0NvbW1hbmQsIDEpO1xuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoTGlzdE9iamVjdHNWMkNvbW1hbmQsIDIpO1xuXG4gICAgLy8gdGFnZ2luZyBpcyBwZXJmb3JtZWRcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKEdldE9iamVjdFRhZ2dpbmdDb21tYW5kLCBrZXlDb3VudCk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhEZWxldGVPYmplY3RUYWdnaW5nQ29tbWFuZCwgMTAwMCk7IC8vIDEwMDAgaW4gdXNlIGFzc2V0cyBhcmUgZXJyb25lb3VzbHkgdGFnZ2VkXG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhQdXRPYmplY3RUYWdnaW5nQ29tbWFuZCwgNTAwMCk7IC8vIDgwMDAtNDAwMCBhc3NldHMgbmVlZCB0byBiZSB0YWdnZWQsICsgMTAwMCAoc2luY2UgdW50YWcgYWxzbyBjYWxscyB0aGlzKVxuICB9KTtcblxuICB0ZXN0KCdkZWxldGUtdGFnZ2VkIG9ubHknLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBtb2NrQ2xpZW50c0ZvckxhcmdlT2JqZWN0cygpO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDEsXG4gICAgICBhY3Rpb246ICdkZWxldGUtdGFnZ2VkJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QoY2ZuQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0U3RhY2tzQ29tbWFuZCwgMSk7XG4gICAgZXhwZWN0KHMzQ2xpZW50KS50b0hhdmVSZWNlaXZlZENvbW1hbmRUaW1lcyhMaXN0T2JqZWN0c1YyQ29tbWFuZCwgMik7XG5cbiAgICAvLyBkZWxldGUgcHJldmlvdXNseSB0YWdnZWQgb2JqZWN0c1xuICAgIGV4cGVjdChzM0NsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoR2V0T2JqZWN0VGFnZ2luZ0NvbW1hbmQsIGtleUNvdW50KTtcbiAgICBleHBlY3QoczNDbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKERlbGV0ZU9iamVjdHNDb21tYW5kLCA0KTsgLy8gNDAwMCBpc29sYXRlZCBhc3NldHMgYXJlIGFscmVhZHkgdGFnZ2VkLCBkZWxldGVkIGluIGJhdGNoZXMgb2YgMTAwMFxuICB9KTtcblxuICBmdW5jdGlvbiBtb2NrQ2xpZW50c0ZvckxhcmdlT2JqZWN0cygpIHtcbiAgICBjZm5DbGllbnQub24oTGlzdFN0YWNrc0NvbW1hbmQpLnJlc29sdmVzKHtcbiAgICAgIFN0YWNrU3VtbWFyaWVzOiBbXG4gICAgICAgIHsgU3RhY2tOYW1lOiAnU3RhY2sxJywgU3RhY2tTdGF0dXM6ICdDUkVBVEVfQ09NUExFVEUnLCBDcmVhdGlvblRpbWU6IG5ldyBEYXRlKCkgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjZm5DbGllbnQub24oR2V0VGVtcGxhdGVTdW1tYXJ5Q29tbWFuZCkucmVzb2x2ZXMoe1xuICAgICAgUGFyYW1ldGVyczogW3tcbiAgICAgICAgUGFyYW1ldGVyS2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgIERlZmF1bHRWYWx1ZTogJy9jZGstYm9vdHN0cmFwL2FiY2RlL3ZlcnNpb24nLFxuICAgICAgfV0sXG4gICAgfSk7XG5cbiAgICAvLyBhZGQgZXZlcnkgNXRoIGFzc2V0IGhhc2ggdG8gdGhlIG1vY2sgdGVtcGxhdGUgYm9keTogODAwMCBhc3NldHMgYXJlIGlzb2xhdGVkXG4gICAgY29uc3QgbW9ja1RlbXBsYXRlQm9keSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5Q291bnQ7IGkrPTUpIHtcbiAgICAgIG1vY2tUZW1wbGF0ZUJvZHkucHVzaChgYXNzZXQke2l9aGFzaGApO1xuICAgIH1cbiAgICBjZm5DbGllbnQub24oR2V0VGVtcGxhdGVDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgICBUZW1wbGF0ZUJvZHk6IG1vY2tUZW1wbGF0ZUJvZHkuam9pbignLScpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29udGVudHM6IHsgS2V5OiBzdHJpbmc7IExhc3RNb2RpZmllZDogRGF0ZSB9W10gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleUNvdW50OyBpKyspIHtcbiAgICAgIGNvbnRlbnRzLnB1c2goe1xuICAgICAgICBLZXk6IGBhc3NldCR7aX1oYXNoYCxcbiAgICAgICAgTGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgwKSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHMzQ2xpZW50Lm9uKExpc3RPYmplY3RzVjJDb21tYW5kKS5yZXNvbHZlcyh7XG4gICAgICBDb250ZW50czogY29udGVudHMsXG4gICAgICBLZXlDb3VudDoga2V5Q291bnQsXG4gICAgfSk7XG5cbiAgICAvLyBldmVyeSBvdGhlciBvYmplY3QgaGFzIHRoZSBpc29sYXRlZCB0YWc6IG9mIHRoZSA4MDAwIGlzb2xhdGVkIGFzc2V0cywgNDAwMCBhbHJlYWR5IGFyZSB0YWdnZWQuXG4gICAgLy8gb2YgdGhlIDIwMDAgaW4gdXNlIGFzc2V0cywgMTAwMCBhcmUgdGFnZ2VkLlxuICAgIHMzQ2xpZW50Lm9uKEdldE9iamVjdFRhZ2dpbmdDb21tYW5kKS5jYWxsc0Zha2UoKHBhcmFtcykgPT4gKHtcbiAgICAgIFRhZ1NldDogTnVtYmVyKHBhcmFtcy5LZXlbcGFyYW1zLktleS5sZW5ndGggLSA1XSkgJSAyID09PSAwXG4gICAgICAgID8gW3sgS2V5OiBTM19JU09MQVRFRF9UQUcsIFZhbHVlOiBuZXcgRGF0ZSgyMDAwLCAxLCAxKS50b0lTT1N0cmluZygpIH1dXG4gICAgICAgIDogW10sXG4gICAgfSkpO1xuICB9XG59KTtcblxuZGVzY3JpYmUoJ0JhY2tncm91bmRTdGFja1JlZnJlc2gnLCAoKSA9PiB7XG4gIGxldCBiYWNrZ3JvdW5kUmVmcmVzaDogQmFja2dyb3VuZFN0YWNrUmVmcmVzaDtcbiAgbGV0IHJlZnJlc2hQcm9wczogQmFja2dyb3VuZFN0YWNrUmVmcmVzaFByb3BzO1xuICBsZXQgc2V0VGltZW91dFNweTogamVzdC5TcHlJbnN0YW5jZTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcbiAgICBzZXRUaW1lb3V0U3B5ID0gamVzdC5zcHlPbihnbG9iYWwsICdzZXRUaW1lb3V0Jyk7XG5cbiAgICBjb25zdCBmb28gPSBuZXcgTW9ja1NkaygpO1xuXG4gICAgcmVmcmVzaFByb3BzID0ge1xuICAgICAgY2ZuOiBmb28uY2xvdWRGb3JtYXRpb24oKSxcbiAgICAgIGFjdGl2ZUFzc2V0czogbmV3IEFjdGl2ZUFzc2V0Q2FjaGUoKSxcbiAgICB9O1xuXG4gICAgYmFja2dyb3VuZFJlZnJlc2ggPSBuZXcgQmFja2dyb3VuZFN0YWNrUmVmcmVzaChyZWZyZXNoUHJvcHMpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxUaW1lcnMoKTtcbiAgICBzZXRUaW1lb3V0U3B5Lm1vY2tSZXN0b3JlKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBzdGFydCBhZnRlciBhIGRlbGF5JywgKCkgPT4ge1xuICAgIHZvaWQgYmFja2dyb3VuZFJlZnJlc2guc3RhcnQoKTtcbiAgICBleHBlY3Qoc2V0VGltZW91dFNweSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChzZXRUaW1lb3V0U3B5KS50b0hhdmVCZWVuTGFzdENhbGxlZFdpdGgoZXhwZWN0LmFueShGdW5jdGlvbiksIDMwMDAwMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCByZWZyZXNoIHN0YWNrcyBhbmQgc2NoZWR1bGUgbmV4dCByZWZyZXNoJywgYXN5bmMgKCkgPT4ge1xuICAgIHZvaWQgYmFja2dyb3VuZFJlZnJlc2guc3RhcnQoKTtcblxuICAgIC8vIFJ1biB0aGUgZmlyc3QgdGltZXIgKHdoaWNoIHNob3VsZCB0cmlnZ2VyIHRoZSBmaXJzdCByZWZyZXNoKVxuICAgIGF3YWl0IGplc3QucnVuT25seVBlbmRpbmdUaW1lcnNBc3luYygpO1xuXG4gICAgZXhwZWN0KGNmbkNsaWVudCkudG9IYXZlUmVjZWl2ZWRDb21tYW5kVGltZXMoTGlzdFN0YWNrc0NvbW1hbmQsIDEpO1xuXG4gICAgZXhwZWN0KHNldFRpbWVvdXRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTsgLy8gT25jZSBmb3Igc3RhcnQsIG9uY2UgZm9yIG5leHQgcmVmcmVzaFxuICAgIGV4cGVjdChzZXRUaW1lb3V0U3B5KS50b0hhdmVCZWVuTGFzdENhbGxlZFdpdGgoZXhwZWN0LmFueShGdW5jdGlvbiksIDMwMDAwMCk7XG5cbiAgICAvLyBSdW4gdGhlIGZpcnN0IHRpbWVyICh3aGljaCB0cmlnZ2VycyB0aGUgZmlyc3QgcmVmcmVzaClcbiAgICBhd2FpdCBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzQXN5bmMoKTtcblxuICAgIGV4cGVjdChjZm5DbGllbnQpLnRvSGF2ZVJlY2VpdmVkQ29tbWFuZFRpbWVzKExpc3RTdGFja3NDb21tYW5kLCAyKTtcbiAgICBleHBlY3Qoc2V0VGltZW91dFNweSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpOyAvLyBUd28gcmVmcmVzaGVzIHBsdXMgb25lIG1vcmUgc2NoZWR1bGVkXG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCB3YWl0IGZvciB0aGUgbmV4dCByZWZyZXNoIGlmIGNhbGxlZCB3aXRoaW4gdGltZSBmcmFtZScsIGFzeW5jICgpID0+IHtcbiAgICB2b2lkIGJhY2tncm91bmRSZWZyZXNoLnN0YXJ0KCk7XG5cbiAgICAvLyBSdW4gdGhlIGZpcnN0IHRpbWVyICh3aGljaCB0cmlnZ2VycyB0aGUgZmlyc3QgcmVmcmVzaClcbiAgICBhd2FpdCBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzQXN5bmMoKTtcblxuICAgIGNvbnN0IHdhaXRQcm9taXNlID0gYmFja2dyb3VuZFJlZnJlc2gubm9PbGRlclRoYW4oMTgwMDAwKTsgLy8gMyBtaW51dGVzXG4gICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDEyMDAwMCk7IC8vIEFkdmFuY2UgdGltZSBieSAyIG1pbnV0ZXNcblxuICAgIGF3YWl0IGV4cGVjdCh3YWl0UHJvbWlzZSkucmVzb2x2ZXMudG9CZVVuZGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgd2FpdCBmb3IgdGhlIG5leHQgcmVmcmVzaCBpZiByZWZyZXNoIGxhbmRzIGJlZm9yZSB0aGUgdGltZW91dCcsIGFzeW5jICgpID0+IHtcbiAgICB2b2lkIGJhY2tncm91bmRSZWZyZXNoLnN0YXJ0KCk7XG5cbiAgICAvLyBSdW4gdGhlIGZpcnN0IHRpbWVyICh3aGljaCB0cmlnZ2VycyB0aGUgZmlyc3QgcmVmcmVzaClcbiAgICBhd2FpdCBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzQXN5bmMoKTtcbiAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMjQwMDApOyAvLyBBZHZhbmNlIHRpbWUgYnkgNCBtaW51dGVzXG5cbiAgICBjb25zdCB3YWl0UHJvbWlzZSA9IGJhY2tncm91bmRSZWZyZXNoLm5vT2xkZXJUaGFuKDMwMDAwMCk7IC8vIDUgbWludXRlc1xuICAgIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSgxMjAwMDApOyAvLyBBZHZhbmNlIHRpbWUgYnkgMiBtaW51dGVzLCByZWZyZXNoIHNob3VsZCBmaXJlXG5cbiAgICBhd2FpdCBleHBlY3Qod2FpdFByb21pc2UpLnJlc29sdmVzLnRvQmVVbmRlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHJlamVjdCBpZiB0aGUgcmVmcmVzaCB0YWtlcyB0b28gbG9uZycsIGFzeW5jICgpID0+IHtcbiAgICB2b2lkIGJhY2tncm91bmRSZWZyZXNoLnN0YXJ0KCk7XG5cbiAgICAvLyBSdW4gdGhlIGZpcnN0IHRpbWVyICh3aGljaCB0cmlnZ2VycyB0aGUgZmlyc3QgcmVmcmVzaClcbiAgICBhd2FpdCBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzQXN5bmMoKTtcbiAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMTIwMDAwKTsgLy8gQWR2YW5jZSB0aW1lIGJ5IDIgbWludXRlc1xuXG4gICAgY29uc3Qgd2FpdFByb21pc2UgPSBiYWNrZ3JvdW5kUmVmcmVzaC5ub09sZGVyVGhhbigwKTsgLy8gMCBzZWNvbmRzXG4gICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDEyMDAwMCk7IC8vIEFkdmFuY2UgdGltZSBieSAyIG1pbnV0ZXNcblxuICAgIGF3YWl0IGV4cGVjdCh3YWl0UHJvbWlzZSkucmVqZWN0cy50b1Rocm93KCdyZWZyZXNoU3RhY2tzIHRvb2sgdG9vIGxvbmc7IHRoZSBiYWNrZ3JvdW5kIHRocmVhZCBsaWtlbHkgdGhyZXcgYW4gZXJyb3InKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ1Byb2dyZXNzUHJpbnRlcicsICgpID0+IHtcbiAgbGV0IHByb2dyZXNzUHJpbnRlcjogUHJvZ3Jlc3NQcmludGVyO1xuICBsZXQgc2V0SW50ZXJ2YWw6IGplc3QuU3B5SW5zdGFuY2U7XG4gIGxldCBjbGVhckludGVydmFsOiBqZXN0LlNweUluc3RhbmNlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xuICAgIHNldEludGVydmFsID0gamVzdC5zcHlPbihnbG9iYWwsICdzZXRJbnRlcnZhbCcpO1xuICAgIGNsZWFySW50ZXJ2YWwgPSBqZXN0LnNweU9uKGdsb2JhbCwgJ2NsZWFySW50ZXJ2YWwnKTtcblxuICAgIHByb2dyZXNzUHJpbnRlciA9IG5ldyBQcm9ncmVzc1ByaW50ZXIoMCwgMTAwMCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICAgIHNldEludGVydmFsLm1vY2tSZXN0b3JlKCk7XG4gICAgY2xlYXJJbnRlcnZhbC5tb2NrUmVzdG9yZSgpO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgaWYgc3RhcnQgaXMgY2FsbGVkIHR3aWNlIHdpdGhvdXQgc3RvcCcsICgpID0+IHtcbiAgICBwcm9ncmVzc1ByaW50ZXIuc3RhcnQoKTtcblxuICAgIGV4cGVjdChzZXRJbnRlcnZhbCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdCgoKSA9PiBwcm9ncmVzc1ByaW50ZXIuc3RhcnQoKSkudG9UaHJvdygnUHJvZ3Jlc3NQcmludGVyIGlzIGFscmVhZHkgcnVubmluZy4gU3RvcCBpdCBmaXJzdCB1c2luZyB0aGUgc3RvcCgpIG1ldGhvZCBiZWZvcmUgc3RhcnRpbmcgaXQgYWdhaW4uJyk7XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIGRheXNJblRoZVBhc3QoZGF5czogbnVtYmVyKTogRGF0ZSB7XG4gIGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuICBkLnNldERhdGUoZC5nZXREYXRlKCkgLSBkYXlzKTtcbiAgcmV0dXJuIGQ7XG59XG5cbmZ1bmN0aW9uIHllYXJzSW5UaGVGdXR1cmUoeWVhcnM6IG51bWJlcik6IERhdGUge1xuICBjb25zdCBkID0gbmV3IERhdGUoKTtcbiAgZC5zZXRGdWxsWWVhcihkLmdldEZ1bGxZZWFyKCkgKyB5ZWFycyk7XG4gIHJldHVybiBkO1xufVxuIl19